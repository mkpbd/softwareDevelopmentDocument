
অ্যাঙ্গুলারের মূল ভিত্তিগুলোর মধ্যে সার্ভিস এবং ডিপেন্ডেন্সি ইনজেকশন (DI) অত্যন্ত গুরুত্বপূর্ণ। এরা অ্যাপ্লিকেশনকে সংগঠিত, রক্ষণাবেক্ষণে সহজ এবং টেস্টেবল করতে সাহায্য করে।

**পঞ্চম পর্ব: সার্ভিস (Services) এবং ডিপেন্ডেন্সি ইনজেকশন (Dependency Injection)**

কম্পোনেন্টগুলো UI (ইউজার ইন্টারফেস) এবং ব্যবহারকারীর ইন্টার‍্যাকশন হ্যান্ডেল করার জন্য তৈরি। কিন্তু ডেটা আনা, ডেটা প্রক্রিয়াকরণ বা অন্য কোনো গ্লোবাল লজিক কি কম্পোনেন্টের মধ্যে রাখা উচিত? না। এই কাজগুলোর জন্য অ্যাঙ্গুলারে সার্ভিস ব্যবহার করা হয়।

**১. সার্ভিস (Services) কী?**

*   অ্যাঙ্গুলার সার্ভিস হলো মূলত একটি সিম্পল TypeScript ক্লাস।
*   এতে ডেটা (যেমন কোনো কনফিগারেশন বা Fetch করা ডেটা) থাকতে পারে।
*   এতে লজিক থাকতে পারে (যেমন ডেটা আনা, লগইন করা, লগিং করা, ক্যালকুলেশন করা ইত্যাদি)।
*   সার্ভিসের নিজস্ব কোনো টেমপ্লেট বা HTML ভিউ থাকে না।
*   সার্ভিস সাধারণত বিভিন্ন কম্পোনেন্ট বা অন্যান্য সার্ভিস দ্বারা ব্যবহার হওয়ার জন্য তৈরি হয়।

**কেন সার্ভিস ব্যবহার করবো?**

*   **কোড পুনরাবৃত্তি কমানো (Reduce Code Duplication):** একই লজিক বা ডেটা একাধিক কম্পোনেন্টে প্রয়োজন হলে, সেটি একটি সার্ভিসে রেখে বিভিন্ন কম্পোনেন্ট থেকে কল করা যেতে পারে।
*   **কম্পোনেন্টকে পরিষ্কার রাখা (Keep Components Clean):** কম্পোনেন্টের মূল কাজ হলো ডেটা দেখানো এবং ব্যবহারকারীর ইভেন্ট হ্যান্ডেল করা। ভারী ডেটা লজিক বা দূরবর্তী সার্ভার থেকে ডেটা আনার মতো কাজগুলো সার্ভিসে রাখা উচিত। একে **Separation of Concerns** বলা হয়।
*   **ডেটা শেয়ার করা (Share Data):** একাধিক কম্পোনেন্টের মধ্যে ডেটা শেয়ার করার জন্য সার্ভিস একটি চমৎকার উপায়। একটি সার্ভিসের ইনস্ট্যান্সে ডেটা রাখলে, সেই ইনস্ট্যান্স ব্যবহার করা সমস্ত কম্পোনেন্ট একই ডেটা অ্যাক্সেস করতে পারবে।
*   **মেইনটেনেন্স ও টেস্ট করা সহজ (Easier Maintenance and Testing):** লজিক সার্ভিসে আলাদা করে রাখলে সেটির রক্ষণাবেক্ষণ ও ইউনিট টেস্ট করা অনেক সহজ হয়, কারণ সেখানে UI এর কোনো বিষয় থাকে না।

**২. `@Injectable()` ডেকোরেটর**

যেকোনো TypeScript ক্লাসকে অ্যাঙ্গুলারের ডিপেন্ডেন্সি ইনজেকশন সিস্টেমে ব্যবহার করার জন্য এটিকে `@Injectable()` ডেকোরেটর দিয়ে চিহ্নিত করতে হয়। `@Injectable()` ডেকোরেটরটি ক্লাসটিকে ইনজেকশন করার জন্য প্রস্তুত করে তোলে।

আধুনিক অ্যাঙ্গুলারে `@Injectable()` ডেকোরেটরের মধ্যে `providedIn` প্রোপার্টি ব্যবহার করা হয়, যা সার্ভিসটি কোথায় "প্রোভাইড" বা উপলব্ধ হবে তা নির্দিষ্ট করে।

*   `@Injectable({ providedIn: 'root' })`: এটি স্ট্যান্ডার্ড প্র্যাকটিস। এর মানে হলো সার্ভিসটি অ্যাপ্লিকেশনের রুট ইনজেক্টরের মাধ্যমে প্রোভাইড করা হবে। এর ফলে পুরো অ্যাপ্লিকেশন জুড়ে সার্ভিসটির একটি মাত্র (Singleton) ইনস্ট্যান্স তৈরি হবে। যেকোনো কম্পোনেন্ট, সার্ভিস বা অন্য যেকোনো অ্যাঙ্গুলার কনস্ট্রাক্ট এটি ইনজেক্ট করতে পারবে।

**উদাহরণ:**
```typescript
import { Injectable } from '@angular/core';

// @Injectable() ডেকোরেটর সার্ভিসকে DI সিস্টেমের জন্য প্রস্তুত করে
@Injectable({
  providedIn: 'root' // পুরো অ্যাপ্লিকেশন জুড়ে সিঙ্গেলটন হিসেবে উপলব্ধ থাকবে
})
export class DataService { // এটি একটি সিম্পল TypeScript ক্লাস

  private items: string[] = ['Item A', 'Item B', 'Item C']; // কিছু ডেটা

  constructor() {
    console.log('DataService তৈরি হয়েছে!'); // দেখানোর জন্য
  }

  getItems(): string[] {
    // ডেটা পাওয়ার লজিক এখানে থাকবে (যেমন HTTP কল)
    return this.items; // আপাতত স্ট্যাটিক ডেটা রিটার্ন করছি
  }

  addItem(item: string): void {
    this.items.push(item);
    console.log('নতুন আইটেম যোগ করা হয়েছে:', item);
  }
}
```

**৩. ডিপেন্ডেন্সি ইনজেকশন (Dependency Injection - DI)**

ডিপেন্ডেন্সি ইনজেকশন হলো একটি ডিজাইন প্যাটার্ন যেখানে একটি ক্লাস (যেমন একটি কম্পোনেন্ট) তার যে অন্য ক্লাসের উপর নির্ভর করে (তার ডিপেন্ডেন্সি), সেটিকে নিজে তৈরি না করে বাইরে থেকে গ্রহণ করে।

অ্যাঙ্গুলার একটি শক্তিশালী DI সিস্টেম ব্যবহার করে। যখন একটি কম্পোনেন্ট বা সার্ভিস অন্য কোনো সার্ভিসকে তার কনস্ট্রাক্টরের মাধ্যমে চায়, অ্যাঙ্গুলার ইনজেক্টর সেই সার্ভিসের একটি ইনস্ট্যান্স খুঁজে বের করে বা তৈরি করে এবং সেটিকে কম্পোনেন্ট/সার্ভিসে সরবরাহ করে।

**DI এর সুবিধা:**

*   **মডুলারিটি (Modularity):** ক্লাসগুলো একে অপরের উপর কম নির্ভরশীল হয়।
*   **টেস্টাবিলিটি (Testability):** ইউনিট টেস্ট করার সময়, আমরা আসল সার্ভিসের পরিবর্তে নকল (Mock) সার্ভিস ইনজেক্ট করতে পারি।
*   **ফ্লেক্সিবিলিটি (Flexibility):** আমরা সহজেই একটি সার্ভিসের বাস্তবায়ন পরিবর্তন করতে পারি, কারণ নির্ভরকারী ক্লাসগুলো জানে না সার্ভিসটি কীভাবে তৈরি হচ্ছে, শুধু জানে কীভাবে ব্যবহার করতে হবে।

**কীভাবে অ্যাঙ্গুলারে DI কাজ করে:**

1.  **প্রোভাইডার (Provider):** কে একটি সার্ভিসের ইনস্ট্যান্স সরবরাহ করবে, তা প্রোভাইডার নির্ধারণ করে। `@Injectable({ providedIn: 'root' })` ব্যবহার করলে অ্যাঙ্গুলার নিজেই রুট ইনজেক্টরে প্রোভাইড করে দেয়। অন্যথায়, মডিউল (`@NgModule`) বা কম্পোনেন্টের (`@Component`) `providers` অ্যারেতে সার্ভিস ক্লাসটিকে যোগ করতে হয়।
2.  **ইনজেক্টর (Injector):** ইনজেক্টর হলো একটি অবজেক্ট যা ডিপেন্ডেন্সি খোঁজে এবং সরবরাহ করে। অ্যাঙ্গুলারের একটি ইনজেক্টর হায়ারার্কি (hierarchy) আছে (রুট ইনজেক্টর, মডিউল ইনজেক্টর, কম্পোনেন্ট ইনজেক্টর)। যখন একটি ডিপেন্ডেন্সি চাওয়া হয়, ইনজেক্টর হায়ারার্কিতে ওপরের দিকে খুঁজে দেখে প্রোভাইডার আছে কিনা। প্রথম যে প্রোভাইডারটি পায়, সেটি সেই ডিপেন্ডেন্সির একটি ইনস্ট্যান্স তৈরি করে বা দেয়।
3.  **ইনজেকশন (Injection):** কনস্ট্রাক্টরের মাধ্যমে ডিপেন্ডেন্সি চাওয়ার প্রক্রিয়াটিই হলো ইনজেকশন।

**৪. সার্ভিস ব্যবহার করার ধাপ (Step-by-Step Example):**

চলো আমরা আগে তৈরি করা `DataService` টি `AppComponent` এর মধ্যে ব্যবহার করি।

**ধাপ ১: সার্ভিস তৈরি (আমরা আগেই `ng generate service data` কমান্ড দিয়ে তৈরি করেছি):**

`src/app/data.service.ts` ফাইল:
```typescript
import { Injectable } from '@angular/core';

@Injectable({
  providedIn: 'root' // এটি নিশ্চিত করে যে সার্ভিসটি ইনজেক্টেবল
})
export class DataService {
  private items: string[] = ['Laptop', 'Mouse', 'Keyboard'];

  constructor() {
    console.log('DataService Ready!');
  }

  getItems(): string[] {
    return this.items;
  }

  addItem(newItem: string): void {
      this.items.push(newItem);
      console.log(`${newItem} যোগ করা হয়েছে।`);
  }
}
```

**ধাপ ২: কম্পোনেন্টে সার্ভিস ইনজেক্ট করা:**

`src/app/app.component.ts` ফাইলটি ওপেন করো।

```typescript
import { Component, OnInit } from '@angular/core';
import { DataService } from './data.service'; // সার্ভিসটি ইমপোর্ট করো

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css']
})
export class AppComponent implements OnInit { // OnInit ইন্টারফেস ইমপ্লিমেন্ট করছি

  title: string = 'সার্ভিস ব্যবহার';
  dataItems: string[] = []; // সার্ভিসের ডেটা রাখার জন্য একটি প্রোপার্টি

  // কনস্ট্রাক্টরের মাধ্যমে সার্ভিসটি ইনজেক্ট করছি
  constructor(private dataService: DataService) {
    // কনস্ট্রাক্টর সাধারণত সিম্পল ইনিশিয়ালাইজেশনের জন্য ব্যবহৃত হয়
    // জটিল লজিক বা ডেটা আনার কাজ ngOnInit এ করা উচিত
    console.log('AppComponent constructor');
  }

  // ngOnInit কম্পোনেন্ট ইনিশিয়ালাইজ হওয়ার পর কল হয়
  ngOnInit(): void {
    console.log('AppComponent ngOnInit');
    // সার্ভিসের getItems() মেথড কল করে ডেটা নিচ্ছি
    this.dataItems = this.dataService.getItems();
  }

  addNewItem(): void {
    const newItem = `New Item ${this.dataItems.length + 1}`;
    this.dataService.addItem(newItem); // সার্ভিসের addItem মেথড কল করছি
    this.dataItems = this.dataService.getItems(); // ডেটা আপডেট করছি
  }
}
```
*   আমরা `DataService` ক্লাসটি ইমপোর্ট করেছি।
*   `constructor(private dataService: DataService)`: এখানে অ্যাঙ্গুলারকে বলা হচ্ছে যে এই কম্পোনেন্টের একটি `DataService` টাইপের ইনস্ট্যান্স প্রয়োজন। `private dataService: DataService` সিনট্যাক্সটি `dataService` নামে একটি ইনস্ট্যান্স ভেরিয়েবল তৈরি করে এবং ইনজেক্টেড সার্ভিসটি তাতে অ্যাসাইন করে।
*   `ngOnInit()` লাইফসাইকেল হুকটি ব্যবহার করেছি। কম্পোনেন্ট তৈরি হওয়ার পর এবং প্রোপার্টিগুলো ইনিশিয়ালাইজ হওয়ার পর এটি কল হয়। ডেটা আনার মতো কাজ এখানে করাই ভালো।
*   সার্ভিসের `getItems()` মেথড কল করে ডেটা `dataItems` অ্যারেতে রেখেছি।
*   নতুন আইটেম যোগ করার জন্য `addNewItem()` মেথড তৈরি করেছি যা সার্ভিসের `addItem()` মেথড ব্যবহার করে। আইটেম যোগ করার পর ডেটা আপডেট করতে `getItems()` আবার কল করেছি (যদিও ডেটা শেয়ার করা থাকলে এটি অটো আপডেট হতে পারতো, এই উদাহরণে সরাসরি সার্ভিসের ডেটা ব্যবহার না করে কম্পোনেন্টের ডেটা ব্যবহার করছি তাই ম্যানুয়ালি আপডেট করছি)।

**ধাপ ৩: টেমপ্লেটে ডেটা দেখানো:**

`src/app/app.component.html` ফাইলটি ওপেন করো। আগের কোডের নিচে এটি যোগ করতে পারো।

```html
<hr>
<h2>{{ title }}</h2>

<h3>আইটেম তালিকা:</h3>
<ul>
  <li *ngFor="let item of dataItems">
    {{ item }}
  </li>
</ul>

<button (click)="addNewItem()">নতুন আইটেম যোগ করুন</button>
```
*   আমরা `*ngFor` স্ট্রাকচারাল ডাইরেক্টিভ ব্যবহার করে `dataItems` অ্যারের প্রতিটি আইটেম একটি `<li>` ট্যাগে দেখাচ্ছি।
*   বাটনে ক্লিক করলে কম্পোনেন্টের `addNewItem()` মেথড কল হবে।

এখন যদি `ng serve` দিয়ে অ্যাপ্লিকেশন রান করো, তাহলে `DataService` থেকে ডেটা লোড হয়ে কম্পোনেন্টে দেখাবে। নতুন আইটেম যোগ বাটনে ক্লিক করলে সার্ভিসে আইটেম যোগ হবে এবং তালিকা আপডেট হবে।

**৪. `providedIn` এর অন্যান্য অপশন (সংক্ষেপে):**

*   `providedIn: 'root'` (বা omitted): ডিফল্ট প্রোভাইডার। পুরো অ্যাপ্লিকেশন জুড়ে একটি সিঙ্গেলটন ইনস্ট্যান্স পাওয়া যায়। এটি রুট ইনজেক্টরে প্রোভাইড হয়।
*   `providedIn: 'platform'`: রুট ইনজেক্টরের উপরের লেভেলে প্রোভাইড হয়। মাল্টিপল অ্যাঙ্গুলার অ্যাপ্লিকেশন একই HTML পেজে রান করলে এটি ব্যবহার হতে পারে, খুব কম ব্যবহার হয়।
*   `providedIn: Any Service/Module/Component Class`: সার্ভিসকে নির্দিষ্ট মডিউল বা কম্পোনেন্টের ইনজেক্টরে প্রোভাইড করার জন্য।
    *   যদি একটি ফিচার মডিউলের `providers` অ্যারেতে সার্ভিসটি প্রোভাইড করো, তাহলে সেই মডিউলের আওতাধীন কম্পোনেন্ট ও সার্ভিসগুলো সেই সার্ভিসের ইনস্ট্যান্স পাবে। অন্য মডিউল পাবে না।
    *   যদি একটি কম্পোনেন্টের `providers` অ্যারেতে প্রোভাইড করো, তাহলে সেই কম্পোনেন্টের প্রতিটি নতুন ইনস্ট্যান্স সার্ভিসের একটি *নতুন* ইনস্ট্যান্স পাবে। এটি ডেটা শেয়ারিংয়ের জন্য সাধারণত ব্যবহার হয় না, বরং কম্পোনেন্টের জন্য নির্দিষ্ট ইউটিলিটি বা স্টেট ম্যানেজমেন্টের জন্য ব্যবহার হতে পারে।
*   **`providedIn: null` (বা omit `providedIn` and list in `providers` array):** `@Injectable` ডেকোরেটর ছাড়া ক্লাসকে `providers` অ্যারেতে যোগ করলেও সার্ভিস হিসেবে কাজ করবে, তবে `@Injectable` ব্যবহার করাই স্ট্যান্ডার্ড প্র্যাকটিস।

`providedIn: 'root'` হলো সবচেয়ে প্রচলিত এবং প্রস্তাবিত পদ্ধতি বেশিরভাগ শেয়ারযোগ্য সার্ভিসের জন্য, কারণ এটি কোড-স্প্লিটিং এর সুবিধা দেয় এবং নিশ্চিত করে যে পুরো অ্যাপ্লিকেশনে একটি মাত্র ইনস্ট্যান্স ব্যবহার হচ্ছে।

---

**আজকের সারসংক্ষেপ:**
*   **সার্ভিস:** ডেটা এবং লজিক শেয়ার করার জন্য ব্যবহৃত সিম্পল TypeScript ক্লাস, যাদের নিজস্ব টেমপ্লেট নেই।
*   **কেন সার্ভিস:** কোড রিইউজ, কম্পোনেন্ট পরিষ্কার রাখা, ডেটা শেয়ার করা, মেইনটেনেন্স ও টেস্টিং সহজ করা।
*   **`@Injectable()`:** ক্লাসকে DI সিস্টেমে ব্যবহারের জন্য চিহ্নিত করে।
*   **`providedIn: 'root'`:** পুরো অ্যাপ্লিকেশন জুড়ে সার্ভিসের একটি সিঙ্গেলটন ইনস্ট্যান্স তৈরি করে।
*   **ডিপেন্ডেন্সি ইনজেকশন (DI):** একটি ডিজাইন প্যাটার্ন যেখানে ক্লাস তার ডিপেন্ডেন্সি বাইরে থেকে পায় (কনস্ট্রাক্টরের মাধ্যমে)। অ্যাঙ্গুলারের ইনজেক্টর সিস্টেম এটি হ্যান্ডেল করে।

সার্ভিস এবং DI অ্যাঙ্গুলারের আর্কিটেকচারের কেন্দ্রবিন্দুতে আছে। এগুলো ব্যবহার করে আমরা মেইনটেইনেবল এবং স্কেলেবল অ্যাপ্লিকেশন তৈরি করতে পারি।

**পরবর্তী পর্ব:** আমরা অ্যাঙ্গুলারের রাউটিং (Routing) নিয়ে আলোচনা করবো, যা আমাদের অ্যাপ্লিকেশনে মাল্টিপল পেজ তৈরি করতে সাহায্য করবে।

তোমাদের কাজ হবে একটি নতুন সার্ভিস তৈরি করা, তাতে কিছু লজিক রাখা, এবং একাধিক কম্পোনেন্ট থেকে সেই সার্ভিসটি ইনজেক্ট করে ব্যবহার করা। দেখো দুটি ভিন্ন কম্পোনেন্ট একই সার্ভিসের ইনস্ট্যান্স ব্যবহার করে ডেটা শেয়ার করতে পারছে কিনা।

কোনো প্রশ্ন থাকলে জিজ্ঞাসা করো!