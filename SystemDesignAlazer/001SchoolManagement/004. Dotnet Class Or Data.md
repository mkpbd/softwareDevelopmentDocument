
Okay, here are the C# .NET entity classes based on your data model. I'll use data annotations for primary keys, foreign keys, required fields, string lengths, etc., which are commonly used with Entity Framework Core.

I'll also define the Enums separately for clarity.

```csharp
// Add necessary using statements at the top of your .cs files
// using System;
// using System.Collections.Generic;
// using System.ComponentModel.DataAnnotations;
// using System.ComponentModel.DataAnnotations.Schema;

// ------------ ENUMS ------------
public enum UserTypeEnum
{
    Student,
    Parent,
    Teacher,
    Admin,
    Staff // General staff
}

public enum GenderEnum
{
    Male,
    Female,
    Other
}

public enum EnrollmentStatusEnum
{
    Enrolled,
    Graduated,
    Withdrawn,
    Transferred
}

public enum EmploymentStatusEnum
{
    Active,
    Resigned,
    Terminated
}

public enum SalaryPaymentStatusEnum
{
    Pending,
    Paid,
    Processing
}

public enum DayOfWeekEnum
{
    Monday,
    Tuesday,
    Wednesday,
    Thursday,
    Friday,
    Saturday,
    Sunday
}

public enum AttendanceStatusEnum // For Students
{
    Present,
    Absent,
    Late,
    Excused
}

public enum StaffAttendanceStatusEnum
{
    Present,
    Absent,
    Late,
    OnLeave,
    HalfDay
}

public enum AssignmentStatusEnum
{
    Pending,
    Submitted,
    Late,
    Graded
}

public enum ReportCardStatusEnum
{
    Draft,
    Published,
    Archived
}

public enum FeeFrequencyEnum
{
    Monthly,
    Quarterly,
    HalfYearly,
    Annually,
    OneTime
}

public enum FeeInstallmentStatusEnum
{
    Pending,
    PartiallyPaid,
    Paid,
    Overdue,
    Waived
}

public enum PaymentModeEnum
{
    Cash,
    Card,
    Online,
    Cheque
}

public enum BookIssueStatusEnum
{
    Issued,
    Returned,
    Lost
}

public enum FineStatusEnum
{
    None,
    Pending,
    Paid
}

public enum VehicleStatusEnum
{
    Active,
    Maintenance,
    Inactive
}

public enum InventoryItemConditionEnum
{
    Good,
    Fair,
    NeedsRepair,
    Damaged
}

public enum HostelRoomStatusEnum
{
    Available,
    Occupied,
    Maintenance
}

// ------------ ENTITY CLASSES ------------

// --- Core & User Management Tables ---

public class User
{
    [Key]
    public int UserId { get; set; }

    [Required]
    [StringLength(50)]
    // Consider [Index(IsUnique = true)] if using EF Core attributes for unique constraints
    public string Username { get; set; }

    [Required]
    [StringLength(255)]
    public string PasswordHash { get; set; }

    [Required]
    [StringLength(100)]
    // Consider [Index(IsUnique = true)]
    [EmailAddress]
    public string Email { get; set; }

    [Required]
    public UserTypeEnum UserType { get; set; }

    public bool IsActive { get; set; } = true;
    public DateTime? LastLogin { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<UserRole> UserRoles { get; set; } = new List<UserRole>();
    public virtual Student? StudentProfile { get; set; } // If User is a Student
    public virtual Parent? ParentProfile { get; set; }   // If User is a Parent
    public virtual Staff? StaffProfile { get; set; }     // If User is a Staff
    public virtual ICollection<Announcement> PostedAnnouncements { get; set; } = new List<Announcement>();
    public virtual ICollection<Message> SentMessages { get; set; } = new List<Message>();
    public virtual ICollection<Message> ReceivedMessages { get; set; } = new List<Message>();
    public virtual ICollection<BookIssue> BookIssues { get; set; } = new List<BookIssue>();
}

public class Role
{
    [Key]
    public int RoleId { get; set; }

    [Required]
    [StringLength(50)]
    // Consider [Index(IsUnique = true)]
    public string RoleName { get; set; }

    public string? Description { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<UserRole> UserRoles { get; set; } = new List<UserRole>();
    public virtual ICollection<RolePermission> RolePermissions { get; set; } = new List<RolePermission>();
    public virtual ICollection<AnnouncementAudience> AnnouncementAudiences { get; set; } = new List<AnnouncementAudience>();

}

// Junction table for User and Role (Many-to-Many)
// For EF Core 5+, you might not need this class explicitly if you follow conventions
// but it's good for clarity and if the join table has extra properties.
public class UserRole
{
    // Composite Key configured in DbContext OnModelCreating or using [PrimaryKey] in EF Core 6+
    public int UserId { get; set; }
    [ForeignKey("UserId")]
    public virtual User User { get; set; }

    public int RoleId { get; set; }
    [ForeignKey("RoleId")]
    public virtual Role Role { get; set; }

    // To configure composite PK in OnModelCreating:
    // modelBuilder.Entity<UserRole>().HasKey(ur => new { ur.UserId, ur.RoleId });
}

public class Permission
{
    [Key]
    public int PermissionId { get; set; }

    [Required]
    [StringLength(100)]
    // Consider [Index(IsUnique = true)]
    public string PermissionName { get; set; }

    public string? Description { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<RolePermission> RolePermissions { get; set; } = new List<RolePermission>();
}

// Junction table for Role and Permission (Many-to-Many)
public class RolePermission
{
    public int RoleId { get; set; }
    [ForeignKey("RoleId")]
    public virtual Role Role { get; set; }

    public int PermissionId { get; set; }
    [ForeignKey("PermissionId")]
    public virtual Permission Permission { get; set; }

    // To configure composite PK in OnModelCreating:
    // modelBuilder.Entity<RolePermission>().HasKey(rp => new { rp.RoleId, rp.PermissionId });
}


// --- Student & Staff Information Tables ---

public class AcademicYear
{
    [Key]
    public int AcademicYearId { get; set; }

    [Required]
    [StringLength(20)]
    public string YearName { get; set; } // e.g., "2023-2024"

    [Required]
    [Column(TypeName = "date")]
    public DateTime StartDate { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime EndDate { get; set; }

    public bool IsCurrent { get; set; } = false;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<StudentEnrollment> StudentEnrollments { get; set; } = new List<StudentEnrollment>();
    public virtual ICollection<StaffSalary> StaffSalaries { get; set; } = new List<StaffSalary>();
    public virtual ICollection<StaffPerformanceReview> StaffPerformanceReviews { get; set; } = new List<StaffPerformanceReview>();
    public virtual ICollection<ClassSubject> ClassSubjects { get; set; } = new List<ClassSubject>();
    public virtual ICollection<TimetableEntry> TimetableEntries { get; set; } = new List<TimetableEntry>();
    public virtual ICollection<StudentAttendance> StudentAttendances { get; set; } = new List<StudentAttendance>();
    public virtual ICollection<Exam> Exams { get; set; } = new List<Exam>();
    public virtual ICollection<Assignment> Assignments { get; set; } = new List<Assignment>();
    public virtual ICollection<GradeScale> GradeScales { get; set; } = new List<GradeScale>();
    public virtual ICollection<ReportCard> ReportCards { get; set; } = new List<ReportCard>();
    public virtual ICollection<FeeStructure> FeeStructures { get; set; } = new List<FeeStructure>();
    public virtual ICollection<StudentFeeInstallment> StudentFeeInstallments { get; set; } = new List<StudentFeeInstallment>();
    public virtual ICollection<VehicleRouteAssignment> VehicleRouteAssignments { get; set; } = new List<VehicleRouteAssignment>();
    public virtual ICollection<StudentTransportAllocation> StudentTransportAllocations { get; set; } = new List<StudentTransportAllocation>();
    public virtual ICollection<HostelAllocation> HostelAllocations { get; set; } = new List<HostelAllocation>();
}

public class Class
{
    [Key]
    public int ClassId { get; set; }

    [Required]
    [StringLength(50)]
    public string ClassName { get; set; } // e.g., "Grade 1", "Class X"

    public int? NumericLevel { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<Section> Sections { get; set; } = new List<Section>();
    public virtual ICollection<StudentEnrollment> StudentEnrollments { get; set; } = new List<StudentEnrollment>();
    public virtual ICollection<ClassSubject> ClassSubjects { get; set; } = new List<ClassSubject>();
    public virtual ICollection<StudentAttendance> StudentAttendances { get; set; } = new List<StudentAttendance>();
    public virtual ICollection<ExamSchedule> ExamSchedules { get; set; } = new List<ExamSchedule>();
    public virtual ICollection<ReportCard> ReportCards { get; set; } = new List<ReportCard>();
    public virtual ICollection<FeeStructure> FeeStructures { get; set; } = new List<FeeStructure>();
    public virtual ICollection<AnnouncementAudience> AnnouncementAudiences { get; set; } = new List<AnnouncementAudience>();
}

public class Section
{
    [Key]
    public int SectionId { get; set; }

    [Required]
    [StringLength(50)]
    public string SectionName { get; set; } // e.g., "A", "Blue"

    public int ClassId { get; set; }
    [ForeignKey("ClassId")]
    public virtual Class Class { get; set; }

    public int? ClassTeacherId { get; set; } // FK to Staff
    [ForeignKey("ClassTeacherId")]
    public virtual Staff? ClassTeacher { get; set; }

    public int? Capacity { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<StudentEnrollment> StudentEnrollments { get; set; } = new List<StudentEnrollment>();
    public virtual ICollection<ClassSubject> ClassSubjects { get; set; } = new List<ClassSubject>();
     public virtual ICollection<StudentAttendance> StudentAttendances { get; set; } = new List<StudentAttendance>();
    public virtual ICollection<ExamSchedule> ExamSchedules { get; set; } = new List<ExamSchedule>();
    public virtual ICollection<ReportCard> ReportCards { get; set; } = new List<ReportCard>();
    public virtual ICollection<AnnouncementAudience> AnnouncementAudiences { get; set; } = new List<AnnouncementAudience>();
}

public class Student
{
    [Key]
    public int StudentId { get; set; }

    public int? UserId { get; set; } // FK to Users, nullable if student doesn't have login
    [ForeignKey("UserId")]
    public virtual User? User { get; set; }

    [Required]
    [StringLength(50)]
    // Consider [Index(IsUnique = true)]
    public string AdmissionNumber { get; set; }

    [Required]
    [StringLength(50)]
    public string FirstName { get; set; }

    [Required]
    [StringLength(50)]
    public string LastName { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime DateOfBirth { get; set; }

    [Required]
    public GenderEnum Gender { get; set; }

    public string? Address { get; set; }

    [StringLength(20)]
    public string? ContactNumber { get; set; }

    [StringLength(100)]
    // Consider [Index(IsUnique = true)]
    [EmailAddress]
    public string? Email { get; set; } // Student's personal email, distinct from User.Email

    [Required]
    [Column(TypeName = "date")]
    public DateTime AdmissionDate { get; set; }

    [StringLength(255)]
    public string? PhotoURL { get; set; }

    [StringLength(5)]
    public string? BloodGroup { get; set; }

    [StringLength(50)]
    public string? Nationality { get; set; }

    [StringLength(100)]
    public string? PreviousSchool { get; set; }

    public EnrollmentStatusEnum EnrollmentStatus { get; set; } = EnrollmentStatusEnum.Enrolled;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<StudentEnrollment> Enrollments { get; set; } = new List<StudentEnrollment>();
    public virtual ICollection<StudentParent> StudentParents { get; set; } = new List<StudentParent>();
    public virtual ICollection<StudentAttendance> Attendances { get; set; } = new List<StudentAttendance>();
    public virtual ICollection<ExamResult> ExamResults { get; set; } = new List<ExamResult>();
    public virtual ICollection<StudentAssignment> StudentAssignments { get; set; } = new List<StudentAssignment>();
    public virtual ICollection<ReportCard> ReportCards { get; set; } = new List<ReportCard>();
    public virtual ICollection<StudentFeeInstallment> FeeInstallments { get; set; } = new List<StudentFeeInstallment>();
    public virtual ICollection<FeePayment> FeePayments { get; set; } = new List<FeePayment>();
    public virtual ICollection<StudentTransportAllocation> TransportAllocations { get; set; } = new List<StudentTransportAllocation>();
    public virtual ICollection<HostelAllocation> HostelAllocations { get; set; } = new List<HostelAllocation>();
}

public class StudentEnrollment
{
    [Key]
    public int EnrollmentId { get; set; }

    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }

    public int ClassId { get; set; }
    [ForeignKey("ClassId")]
    public virtual Class Class { get; set; }

    public int SectionId { get; set; }
    [ForeignKey("SectionId")]
    public virtual Section Section { get; set; }

    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }

    [StringLength(20)]
    public string? RollNumber { get; set; }

    [Column(TypeName = "date")]
    public DateTime EnrollmentDate { get; set; } = DateTime.UtcNow.Date;
    public bool IsActive { get; set; } = true;

    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // For UNIQUE (StudentID, AcademicYearID), configure in OnModelCreating:
    // modelBuilder.Entity<StudentEnrollment>().HasIndex(se => new { se.StudentId, se.AcademicYearId }).IsUnique();
}

public class Parent
{
    [Key]
    public int ParentId { get; set; }

    public int? UserId { get; set; } // FK to Users, for parent portal login
    [ForeignKey("UserId")]
    public virtual User? User { get; set; }

    [Required]
    [StringLength(50)]
    public string FirstName { get; set; }

    [Required]
    [StringLength(50)]
    public string LastName { get; set; }

    [Required]
    [StringLength(30)]
    public string RelationToStudent { get; set; } // e.g., 'Father', 'Mother', 'Guardian'

    [Required]
    [StringLength(20)]
    public string ContactNumber { get; set; }

    [Required]
    [StringLength(100)]
    // Consider [Index(IsUnique = true)]
    [EmailAddress]
    public string Email { get; set; } // Parent's email, distinct from User.Email

    public string? Address { get; set; }

    [StringLength(100)]
    public string? Occupation { get; set; }

    [StringLength(255)]
    public string? PhotoURL { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<StudentParent> StudentParents { get; set; } = new List<StudentParent>();
}

// Junction table for Student and Parent (Many-to-Many)
public class StudentParent
{
    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }

    public int ParentId { get; set; }
    [ForeignKey("ParentId")]
    public virtual Parent Parent { get; set; }

    public bool IsPrimaryContact { get; set; } = false;

    // To configure composite PK in OnModelCreating:
    // modelBuilder.Entity<StudentParent>().HasKey(sp => new { sp.StudentId, sp.ParentId });
}

public class Staff
{
    [Key]
    public int StaffId { get; set; }

    public int? UserId { get; set; } // FK to Users, for staff login
    [ForeignKey("UserId")]
    public virtual User? User { get; set; }

    [Required]
    [StringLength(50)]
    // Consider [Index(IsUnique = true)]
    public string EmployeeID { get; set; }

    [Required]
    [StringLength(50)]
    public string FirstName { get; set; }

    [Required]
    [StringLength(50)]
    public string LastName { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime DateOfBirth { get; set; }

    [Required]
    public GenderEnum Gender { get; set; }

    [Required]
    [StringLength(100)]
    public string Designation { get; set; } // e.g., 'Math Teacher', 'Principal'

    [StringLength(100)]
    public string? Department { get; set; } // e.g., 'Science', 'Administration'

    [Required]
    [StringLength(20)]
    public string ContactNumber { get; set; }

    [Required]
    [StringLength(100)]
    // Consider [Index(IsUnique = true)]
    [EmailAddress]
    public string Email { get; set; } // Staff's email, distinct from User.Email

    public string? Address { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime DateOfJoining { get; set; }

    public string? Qualification { get; set; }
    public string? Experience { get; set; }

    [StringLength(255)]
    public string? PhotoURL { get; set; }

    public EmploymentStatusEnum EmploymentStatus { get; set; } = EmploymentStatusEnum.Active;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<Section> ManagedSections { get; set; } = new List<Section>(); // As ClassTeacher
    public virtual ICollection<StaffSalary> Salaries { get; set; } = new List<StaffSalary>();
    public virtual ICollection<StaffPerformanceReview> PerformanceReviewsGiven { get; set; } = new List<StaffPerformanceReview>(); // Reviews this staff member conducted
    public virtual ICollection<StaffPerformanceReview> PerformanceReviewsReceived { get; set; } = new List<StaffPerformanceReview>(); // Reviews about this staff member
    public virtual ICollection<ClassSubject> TaughtClassSubjects { get; set; } = new List<ClassSubject>();
    public virtual ICollection<TimetableEntry> SubstituteDuties { get; set; } = new List<TimetableEntry>();
    public virtual ICollection<StudentAttendance> RecordedStudentAttendances { get; set; } = new List<StudentAttendance>();
    public virtual ICollection<StaffAttendance> Attendances { get; set; } = new List<StaffAttendance>();
    public virtual ICollection<StaffAttendance> RecordedStaffAttendances { get; set; } = new List<StaffAttendance>();
    public virtual ICollection<ExamResult> RecordedExamResults { get; set; } = new List<ExamResult>();
    public virtual ICollection<Assignment> CreatedAssignments { get; set; } = new List<Assignment>();
    public virtual ICollection<StudentAssignment> GradedAssignments { get; set; } = new List<StudentAssignment>();
    public virtual ICollection<FeePayment> CollectedFeePayments { get; set; } = new List<FeePayment>();
    public virtual ICollection<BookIssue> IssuedBooks { get; set; } = new List<BookIssue>(); // As IssuedBy
    public virtual ICollection<BookIssue> ReceivedBooks { get; set; } = new List<BookIssue>(); // As ReceivedBy
    public virtual ICollection<Vehicle> DrivenVehicles { get; set; } = new List<Vehicle>(); // As Driver
    public virtual ICollection<Vehicle> AttendedVehicles { get; set; } = new List<Vehicle>(); // As Attendant
    public virtual ICollection<Event> OrganizedEvents { get; set; } = new List<Event>();
    public virtual ICollection<HostelBlock> ManagedHostelBlocks { get; set; } = new List<HostelBlock>(); // As Warden
}

public class StaffSalary
{
    [Key]
    public int SalaryId { get; set; }

    public int StaffId { get; set; }
    [ForeignKey("StaffId")]
    public virtual Staff Staff { get; set; }

    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }

    [Required]
    public int Month { get; set; } // 1 for Jan, 12 for Dec

    [Required]
    public int Year { get; set; }

    [Required]
    [Column(TypeName = "decimal(10, 2)")]
    public decimal BasicSalary { get; set; }

    [Column(TypeName = "decimal(10, 2)")]
    public decimal Allowances { get; set; } = 0.00m;

    [Column(TypeName = "decimal(10, 2)")]
    public decimal Deductions { get; set; } = 0.00m;

    [Required]
    [Column(TypeName = "decimal(10, 2)")]
    public decimal NetSalary { get; set; } // Could be calculated, but storing allows historical accuracy if calc logic changes

    [Column(TypeName = "date")]
    public DateTime? PaymentDate { get; set; }

    public SalaryPaymentStatusEnum PaymentStatus { get; set; } = SalaryPaymentStatusEnum.Pending;
    public string? TransactionDetails { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // For UNIQUE (StaffID, Month, Year), configure in OnModelCreating
    // modelBuilder.Entity<StaffSalary>().HasIndex(ss => new { ss.StaffId, ss.Month, ss.Year }).IsUnique();
}

public class StaffPerformanceReview
{
    [Key]
    public int ReviewId { get; set; }

    public int StaffId { get; set; } // Staff being reviewed
    [ForeignKey("StaffId")]
    [InverseProperty("PerformanceReviewsReceived")]
    public virtual Staff StaffMember { get; set; }

    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime ReviewDate { get; set; }

    public int ReviewerStaffId { get; set; } // Staff who conducted the review
    [ForeignKey("ReviewerStaffId")]
    [InverseProperty("PerformanceReviewsGiven")]
    public virtual Staff ReviewerStaff { get; set; }

    [Column(TypeName = "decimal(3, 1)")]
    public decimal? Rating { get; set; } // e.g., 1.0 to 5.0

    public string? Comments { get; set; }
    public string? GoalsForNextPeriod { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}


// --- Academic & Timetable Tables ---

public class Subject
{
    [Key]
    public int SubjectId { get; set; }

    [Required]
    [StringLength(100)]
    public string SubjectName { get; set; }

    [Required]
    [StringLength(20)]
    // Consider [Index(IsUnique = true)]
    public string SubjectCode { get; set; }

    public string? Description { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<ClassSubject> ClassSubjects { get; set; } = new List<ClassSubject>();
    public virtual ICollection<ExamSchedule> ExamSchedules { get; set; } = new List<ExamSchedule>();
}

public class ClassSubject
{
    [Key]
    public int ClassSubjectId { get; set; }

    public int ClassId { get; set; }
    [ForeignKey("ClassId")]
    public virtual Class Class { get; set; }

    public int? SectionId { get; set; } // Nullable if subject is for the whole class
    [ForeignKey("SectionId")]
    public virtual Section? Section { get; set; }

    public int SubjectId { get; set; }
    [ForeignKey("SubjectId")]
    public virtual Subject Subject { get; set; }

    public int TeacherId { get; set; } // FK to Staff
    [ForeignKey("TeacherId")]
    public virtual Staff Teacher { get; set; }

    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // For UNIQUE (ClassID, SectionID, SubjectID, AcademicYearID), configure in OnModelCreating
    // modelBuilder.Entity<ClassSubject>().HasIndex(cs => new { cs.ClassId, cs.SectionId, cs.SubjectId, cs.AcademicYearId }).IsUnique();

    // Navigation Properties
    public virtual ICollection<TimetableEntry> TimetableEntries { get; set; } = new List<TimetableEntry>();
    public virtual ICollection<Assignment> Assignments { get; set; } = new List<Assignment>();
}

public class TimetableSlot
{
    [Key]
    public int SlotId { get; set; }

    [Required]
    public DayOfWeekEnum DayOfWeek { get; set; }

    [Required]
    public TimeSpan StartTime { get; set; } // Use TimeSpan for TIME SQL type

    [Required]
    public TimeSpan EndTime { get; set; }

    [StringLength(50)]
    public string? SlotName { get; set; } // e.g., "Period 1", "Lunch Break"
    public bool IsBreak { get; set; } = false;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<TimetableEntry> TimetableEntries { get; set; } = new List<TimetableEntry>();
}

public class TimetableEntry
{
    [Key]
    public int EntryId { get; set; }

    public int ClassSubjectId { get; set; }
    [ForeignKey("ClassSubjectId")]
    public virtual ClassSubject ClassSubject { get; set; }

    public int SlotId { get; set; }
    [ForeignKey("SlotId")]
    public virtual TimetableSlot Slot { get; set; }

    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }

    [StringLength(20)]
    public string? RoomNumber { get; set; }

    public int? SubstituteTeacherId { get; set; } // FK to Staff
    [ForeignKey("SubstituteTeacherId")]
    public virtual Staff? SubstituteTeacher { get; set; }

    public string? Notes { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // For UNIQUE (ClassSubjectID, SlotID, AcademicYearID), configure in OnModelCreating
    // modelBuilder.Entity<TimetableEntry>().HasIndex(te => new { te.ClassSubjectId, te.SlotId, te.AcademicYearId }).IsUnique();

    // Navigation Property
    public virtual ICollection<StudentAttendance> StudentAttendances { get; set; } = new List<StudentAttendance>();
}

public class StudentAttendance
{
    [Key]
    public int AttendanceId { get; set; }

    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }

    public int ClassId { get; set; } // Denormalized for easier querying
    [ForeignKey("ClassId")]
    public virtual Class Class { get; set; }

    public int SectionId { get; set; } // Denormalized for easier querying
    [ForeignKey("SectionId")]
    public virtual Section Section { get; set; }

    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime AttendanceDate { get; set; }

    public int? TimetableEntryId { get; set; } // For period-wise attendance
    [ForeignKey("TimetableEntryId")]
    public virtual TimetableEntry? TimetableEntry { get; set; }

    [Required]
    public AttendanceStatusEnum Status { get; set; }
    public string? Remarks { get; set; }

    public int RecordedByStaffId { get; set; } // FK to Staff
    [ForeignKey("RecordedByStaffId")]
    public virtual Staff RecordedByStaff { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // For UNIQUE (StudentID, AttendanceDate, TimetableEntryID), configure in OnModelCreating
    // modelBuilder.Entity<StudentAttendance>().HasIndex(sa => new { sa.StudentId, sa.AttendanceDate, sa.TimetableEntryId }).IsUnique();
}

public class StaffAttendance
{
    [Key]
    public int StaffAttendanceId { get; set; }

    public int StaffId { get; set; }
    [ForeignKey("StaffId")]
    [InverseProperty("Attendances")]
    public virtual Staff StaffMember { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime AttendanceDate { get; set; }

    [Required]
    public StaffAttendanceStatusEnum Status { get; set; }
    public TimeSpan? CheckInTime { get; set; }
    public TimeSpan? CheckOutTime { get; set; }
    public string? Remarks { get; set; }

    public int RecordedByStaffId { get; set; } // FK to Staff
    [ForeignKey("RecordedByStaffId")]
    [InverseProperty("RecordedStaffAttendances")]
    public virtual Staff RecordedByStaff { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // For UNIQUE (StaffID, AttendanceDate), configure in OnModelCreating
    // modelBuilder.Entity<StaffAttendance>().HasIndex(sa => new { sa.StaffId, sa.AttendanceDate }).IsUnique();
}


// --- Examination & Academic Records Tables ---

public class ExamType
{
    [Key]
    public int ExamTypeId { get; set; }

    [Required]
    [StringLength(50)]
    public string TypeName { get; set; } // e.g., "Unit Test", "Mid-Term"
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<Exam> Exams { get; set; } = new List<Exam>();
}

public class Exam
{
    [Key]
    public int ExamId { get; set; }

    [Required]
    [StringLength(100)]
    public string ExamName { get; set; } // e.g., "Mid-Term Exams 2023-24"

    public int ExamTypeId { get; set; }
    [ForeignKey("ExamTypeId")]
    public virtual ExamType ExamType { get; set; }

    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime StartDate { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime EndDate { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<ExamSchedule> ExamSchedules { get; set; } = new List<ExamSchedule>();
}

public class ExamSchedule
{
    [Key]
    public int ExamScheduleId { get; set; }

    public int ExamId { get; set; }
    [ForeignKey("ExamId")]
    public virtual Exam Exam { get; set; }

    public int ClassId { get; set; }
    [ForeignKey("ClassId")]
    public virtual Class Class { get; set; }

    public int? SectionId { get; set; } // If exam is section-specific
    [ForeignKey("SectionId")]
    public virtual Section? Section { get; set; }

    public int SubjectId { get; set; }
    [ForeignKey("SubjectId")]
    public virtual Subject Subject { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime ExamDate { get; set; }

    [Required]
    public TimeSpan StartTime { get; set; }

    [Required]
    public TimeSpan EndTime { get; set; }

    [Required]
    [Column(TypeName = "decimal(5, 2)")]
    public decimal MaxMarks { get; set; }

    [Required]
    [Column(TypeName = "decimal(5, 2)")]
    public decimal PassingMarks { get; set; }

    [StringLength(20)]
    public string? RoomNumber { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // For UNIQUE (ExamID, ClassID, SectionID, SubjectID), configure in OnModelCreating
    // modelBuilder.Entity<ExamSchedule>().HasIndex(es => new { es.ExamId, es.ClassId, es.SectionId, es.SubjectId }).IsUnique();

    // Navigation Properties
    public virtual ICollection<ExamResult> ExamResults { get; set; } = new List<ExamResult>();
}

public class ExamResult
{
    [Key]
    public int ResultId { get; set; }

    public int ExamScheduleId { get; set; }
    [ForeignKey("ExamScheduleId")]
    public virtual ExamSchedule ExamSchedule { get; set; }

    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }

    [Required]
    [Column(TypeName = "decimal(5, 2)")]
    public decimal MarksObtained { get; set; }

    [StringLength(10)]
    public string? Grade { get; set; } // Can be calculated or entered
    public string? Remarks { get; set; }
    public bool IsAbsent { get; set; } = false;

    public int RecordedByStaffId { get; set; } // FK to Staff
    [ForeignKey("RecordedByStaffId")]
    public virtual Staff RecordedByStaff { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // For UNIQUE (ExamScheduleID, StudentID), configure in OnModelCreating
    // modelBuilder.Entity<ExamResult>().HasIndex(er => new { er.ExamScheduleId, er.StudentId }).IsUnique();
}

public class Assignment
{
    [Key]
    public int AssignmentId { get; set; }

    public int ClassSubjectId { get; set; }
    [ForeignKey("ClassSubjectId")]
    public virtual ClassSubject ClassSubject { get; set; }

    [Required]
    [StringLength(255)]
    public string Title { get; set; }
    public string? Description { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime AssignedDate { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime DueDate { get; set; }

    [Column(TypeName = "decimal(5, 2)")]
    public decimal? MaxMarks { get; set; }

    [StringLength(255)]
    public string? AttachmentURL { get; set; }

    public int TeacherId { get; set; } // Staff who created/assigned it
    [ForeignKey("TeacherId")]
    public virtual Staff Teacher { get; set; }

    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<StudentAssignment> StudentAssignments { get; set; } = new List<StudentAssignment>();
}

public class StudentAssignment
{
    [Key]
    public int StudentAssignmentId { get; set; }

    public int AssignmentId { get; set; }
    [ForeignKey("AssignmentId")]
    public virtual Assignment Assignment { get; set; }

    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }

    public DateTime? SubmissionDate { get; set; }

    [StringLength(255)]
    public string? SubmittedFileURL { get; set; }

    [Column(TypeName = "decimal(5, 2)")]
    public decimal? MarksObtained { get; set; }
    public string? Feedback { get; set; }
    public AssignmentStatusEnum Status { get; set; } = AssignmentStatusEnum.Pending;

    public int? GradedByStaffId { get; set; } // FK to Staff, nullable
    [ForeignKey("GradedByStaffId")]
    public virtual Staff? GradedByStaff { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // For UNIQUE (AssignmentID, StudentID), configure in OnModelCreating
    // modelBuilder.Entity<StudentAssignment>().HasIndex(sa => new { sa.AssignmentId, sa.StudentId }).IsUnique();
}

public class GradeScale
{
    [Key]
    public int GradeScaleId { get; set; }

    [Required]
    [StringLength(10)]
    public string GradeName { get; set; } // e.g., "A+", "B"

    [Required]
    [Column(TypeName = "decimal(5, 2)")]
    public decimal MinPercentage { get; set; }

    [Required]
    [Column(TypeName = "decimal(5, 2)")]
    public decimal MaxPercentage { get; set; }

    [StringLength(50)]
    public string? Description { get; set; }

    public int? AcademicYearId { get; set; } // Can be year specific
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear? AcademicYear { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}

public class ReportCard
{
    [Key]
    public int ReportCardId { get; set; }

    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }

    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }

    public int ClassId { get; set; }
    [ForeignKey("ClassId")]
    public virtual Class Class { get; set; }

    public int SectionId { get; set; }
    [ForeignKey("SectionId")]
    public virtual Section Section { get; set; }

    [Required]
    [StringLength(50)]
    public string TermName { get; set; } // e.g., "Term 1", "Annual"

    [Column(TypeName = "decimal(5, 2)")]
    public decimal? OverallPercentage { get; set; }

    [StringLength(10)]
    public string? OverallGrade { get; set; }
    public string? TeacherRemarks { get; set; }
    public string? PrincipalRemarks { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime GeneratedDate { get; set; }

    [Column(TypeName = "date")]
    public DateTime? PublishedDate { get; set; }
    public ReportCardStatusEnum Status { get; set; } = ReportCardStatusEnum.Draft;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}


// --- Fee Management Tables ---

public class FeeCategory
{
    [Key]
    public int FeeCategoryId { get; set; }

    [Required]
    [StringLength(100)]
    // Consider [Index(IsUnique = true)]
    public string CategoryName { get; set; } // e.g., "Tuition Fee"
    public string? Description { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<FeeStructure> FeeStructures { get; set; } = new List<FeeStructure>();
}

public class FeeStructure
{
    [Key]
    public int FeeStructureId { get; set; }

    public int FeeCategoryId { get; set; }
    [ForeignKey("FeeCategoryId")]
    public virtual FeeCategory FeeCategory { get; set; }

    public int? ClassId { get; set; } // If fee varies by class
    [ForeignKey("ClassId")]
    public virtual Class? Class { get; set; }

    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }

    [Required]
    [Column(TypeName = "decimal(10, 2)")]
    public decimal Amount { get; set; }

    [Required]
    public FeeFrequencyEnum Frequency { get; set; }

    [StringLength(50)]
    public string? DueDatePattern { get; set; } // e.g., "5th of month"

    [Column(TypeName = "decimal(8, 2)")]
    public decimal LateFeePerDay { get; set; } = 0.00m;
    public string? Description { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // For UNIQUE (FeeCategoryID, ClassID, AcademicYearID, Frequency), configure in OnModelCreating
    // modelBuilder.Entity<FeeStructure>().HasIndex(fs => new { fs.FeeCategoryId, fs.ClassId, fs.AcademicYearId, fs.Frequency }).IsUnique();

    // Navigation Properties
    public virtual ICollection<StudentFeeInstallment> StudentFeeInstallments { get; set; } = new List<StudentFeeInstallment>();
}

public class StudentFeeInstallment
{
    [Key]
    public int InstallmentId { get; set; }

    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }

    public int FeeStructureId { get; set; }
    [ForeignKey("FeeStructureId")]
    public virtual FeeStructure FeeStructure { get; set; }

    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }

    [Required]
    [StringLength(100)]
    public string InstallmentName { get; set; }

    [Required]
    [Column(TypeName = "decimal(10, 2)")]
    public decimal AmountDue { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime DueDate { get; set; }

    [Column(TypeName = "decimal(10, 2)")]
    public decimal AmountPaid { get; set; } = 0.00m;

    [Column(TypeName = "decimal(10, 2)")]
    public decimal WaiverAmount { get; set; } = 0.00m;

    [Column(TypeName = "decimal(8, 2)")]
    public decimal LateFeeApplied { get; set; } = 0.00m;

    // This would be a computed property in C# or handled by DB (AS ... STORED)
    [NotMapped] // If calculated in C#, or use [DatabaseGenerated(DatabaseGeneratedOption.Computed)] if DB handles it
    public decimal BalanceAmount => AmountDue + LateFeeApplied - AmountPaid - WaiverAmount;

    public FeeInstallmentStatusEnum Status { get; set; } = FeeInstallmentStatusEnum.Pending;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<FeePayment> Payments { get; set; } = new List<FeePayment>();
}

public class FeePayment
{
    [Key]
    public int PaymentId { get; set; }

    public int InstallmentId { get; set; }
    [ForeignKey("InstallmentId")]
    public virtual StudentFeeInstallment Installment { get; set; }

    public int StudentId { get; set; } // Denormalized for easier querying
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime PaymentDate { get; set; }

    [Required]
    [Column(TypeName = "decimal(10, 2)")]
    public decimal AmountPaid { get; set; }

    [Required]
    public PaymentModeEnum PaymentMode { get; set; }

    [StringLength(100)]
    public string? TransactionID { get; set; }

    [Required]
    [StringLength(50)]
    // Consider [Index(IsUnique = true)]
    public string ReceiptNumber { get; set; }
    public string? Notes { get; set; }

    public int CollectedByStaffId { get; set; } // FK to Staff
    [ForeignKey("CollectedByStaffId")]
    public virtual Staff CollectedByStaff { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}


// --- Library Tables ---

public class BookCategory
{
    [Key]
    public int BookCategoryId { get; set; }

    [Required]
    [StringLength(100)]
    // Consider [Index(IsUnique = true)]
    public string CategoryName { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<LibraryBook> Books { get; set; } = new List<LibraryBook>();
}

public class LibraryBook
{
    [Key]
    public int BookId { get; set; }

    [Required]
    [StringLength(20)]
    // Consider [Index(IsUnique = true)]
    public string ISBN { get; set; }

    [Required]
    [StringLength(255)]
    public string Title { get; set; }

    [Required]
    [StringLength(255)]
    public string Author { get; set; }

    [StringLength(100)]
    public string? Publisher { get; set; }
    public int? PublicationYear { get; set; }

    [StringLength(50)]
    public string? Edition { get; set; }

    public int BookCategoryId { get; set; }
    [ForeignKey("BookCategoryId")]
    public virtual BookCategory BookCategory { get; set; }

    [Required]
    public int TotalCopies { get; set; } = 1;

    [Required]
    public int AvailableCopies { get; set; } = 1; // Should be managed by triggers or application logic

    [StringLength(50)]
    public string? ShelfLocation { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<BookIssue> Issues { get; set; } = new List<BookIssue>();
}

public class BookIssue
{
    [Key]
    public int IssueId { get; set; }

    public int BookId { get; set; }
    [ForeignKey("BookId")]
    public virtual LibraryBook Book { get; set; }

    public int UserId { get; set; } // Can be Student or Staff
    [ForeignKey("UserId")]
    public virtual User User { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime IssueDate { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime DueDate { get; set; }

    [Column(TypeName = "date")]
    public DateTime? ReturnDate { get; set; }

    [Column(TypeName = "decimal(8, 2)")]
    public decimal FineAmount { get; set; } = 0.00m;
    public FineStatusEnum FineStatus { get; set; } = FineStatusEnum.None;

    public int IssuedByStaffId { get; set; } // Librarian (Staff)
    [ForeignKey("IssuedByStaffId")]
    [InverseProperty("IssuedBooks")]
    public virtual Staff IssuedByStaff { get; set; }

    public int? ReceivedByStaffId { get; set; } // Librarian (Staff) on return
    [ForeignKey("ReceivedByStaffId")]
    [InverseProperty("ReceivedBooks")]
    public virtual Staff? ReceivedByStaff { get; set; }

    public BookIssueStatusEnum Status { get; set; } = BookIssueStatusEnum.Issued;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}


// --- Transport Tables ---

public class TransportRoute
{
    [Key]
    public int RouteId { get; set; }

    [Required]
    [StringLength(100)]
    // Consider [Index(IsUnique = true)]
    public string RouteName { get; set; } // e.g., "Route A - City Center"
    public string? RouteDescription { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<RouteStop> Stops { get; set; } = new List<RouteStop>();
    public virtual ICollection<VehicleRouteAssignment> VehicleAssignments { get; set; } = new List<VehicleRouteAssignment>();
}

public class RouteStop
{
    [Key]
    public int StopId { get; set; }

    public int RouteId { get; set; }
    [ForeignKey("RouteId")]
    public virtual TransportRoute Route { get; set; }

    [Required]
    [StringLength(100)]
    public string StopName { get; set; }

    [Column(TypeName = "decimal(10, 8)")]
    public decimal? Latitude { get; set; }

    [Column(TypeName = "decimal(11, 8)")]
    public decimal? Longitude { get; set; }
    public TimeSpan? PickupTime { get; set; }
    public TimeSpan? DropTime { get; set; }

    [Required]
    public int SequenceOrder { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<StudentTransportAllocation> PickupAllocations { get; set; } = new List<StudentTransportAllocation>();
    public virtual ICollection<StudentTransportAllocation> DropAllocations { get; set; } = new List<StudentTransportAllocation>();
}

public class Vehicle
{
    [Key]
    public int VehicleId { get; set; }

    [Required]
    [StringLength(20)]
    // Consider [Index(IsUnique = true)]
    public string VehicleNumber { get; set; }

    [StringLength(50)]
    public string VehicleType { get; set; } = "Bus";

    [Required]
    public int Capacity { get; set; }

    public int? DriverStaffId { get; set; } // FK to Staff
    [ForeignKey("DriverStaffId")]
    [InverseProperty("DrivenVehicles")]
    public virtual Staff? DriverStaff { get; set; }

    public int? AttendantStaffId { get; set; } // FK to Staff
    [ForeignKey("AttendantStaffId")]
    [InverseProperty("AttendedVehicles")]
    public virtual Staff? AttendantStaff { get; set; }

    [StringLength(50)]
    public string? GPSDeviceID { get; set; }
    public VehicleStatusEnum Status { get; set; } = VehicleStatusEnum.Active;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<VehicleRouteAssignment> RouteAssignments { get; set; } = new List<VehicleRouteAssignment>();
}

public class VehicleRouteAssignment
{
    [Key]
    public int AssignmentId { get; set; }

    public int VehicleId { get; set; }
    [ForeignKey("VehicleId")]
    public virtual Vehicle Vehicle { get; set; }

    public int RouteId { get; set; }
    [ForeignKey("RouteId")]
    public virtual TransportRoute Route { get; set; }

    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime StartDate { get; set; }

    [Column(TypeName = "date")]
    public DateTime? EndDate { get; set; }
    public bool IsActive { get; set; } = true;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // For UNIQUE (VehicleID, RouteID, AcademicYearID), configure in OnModelCreating
    // modelBuilder.Entity<VehicleRouteAssignment>().HasIndex(vra => new { vra.VehicleId, vra.RouteId, vra.AcademicYearId }).IsUnique();

    // Navigation Properties
    public virtual ICollection<StudentTransportAllocation> StudentAllocations { get; set; } = new List<StudentTransportAllocation>();
}

public class StudentTransportAllocation
{
    [Key]
    public int AllocationId { get; set; }

    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }

    public int VehicleRouteAssignmentId { get; set; }
    [ForeignKey("VehicleRouteAssignmentId")]
    public virtual VehicleRouteAssignment VehicleRouteAssignment { get; set; }

    public int PickupStopId { get; set; }
    [ForeignKey("PickupStopId")]
    [InverseProperty("PickupAllocations")]
    public virtual RouteStop PickupStop { get; set; }

    public int DropStopId { get; set; }
    [ForeignKey("DropStopId")]
    [InverseProperty("DropAllocations")]
    public virtual RouteStop DropStop { get; set; }

    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime StartDate { get; set; }

    [Column(TypeName = "date")]
    public DateTime? EndDate { get; set; }
    public bool IsActive { get; set; } = true;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // For UNIQUE (StudentID, AcademicYearID), configure in OnModelCreating
    // modelBuilder.Entity<StudentTransportAllocation>().HasIndex(sta => new { sta.StudentId, sta.AcademicYearId }).IsUnique();
}


// --- Communication Tables ---

public class Announcement
{
    [Key]
    public int AnnouncementId { get; set; }

    [Required]
    [StringLength(255)]
    public string Title { get; set; }

    [Required]
    public string Content { get; set; }
    public DateTime PublishDate { get; set; }
    public DateTime? ExpiryDate { get; set; }

    public int PostedByUserId { get; set; } // User who posted
    [ForeignKey("PostedByUserId")]
    public virtual User PostedByUser { get; set; }

    [StringLength(255)]
    public string? AttachmentURL { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<AnnouncementAudience> Audiences { get; set; } = new List<AnnouncementAudience>();
}

// Junction table for Announcement targeting
public class AnnouncementAudience
{
    // Composite Key to be defined in OnModelCreating
    public int AnnouncementId { get; set; }
    [ForeignKey("AnnouncementId")]
    public virtual Announcement Announcement { get; set; }

    public int? RoleId { get; set; } // Target specific roles
    [ForeignKey("RoleId")]
    public virtual Role? Role { get; set; }

    public int? ClassId { get; set; } // Target specific classes
    [ForeignKey("ClassId")]
    public virtual Class? Class { get; set; }

    public int? SectionId { get; set; } // Target specific sections
    [ForeignKey("SectionId")]
    public virtual Section? Section { get; set; }

    // PK: modelBuilder.Entity<AnnouncementAudience>().HasKey(aa => new { aa.AnnouncementId, aa.RoleId, aa.ClassId, aa.SectionId });
    // Adjust PK if only one target type is used per audience record (e.g., one row per role, one row per class)
    // If so, the PK might be (AnnouncementId, TargetType, TargetId) where TargetType is an enum.
    // For now, assuming a combination is possible.
}


public class Message
{
    [Key]
    public int MessageId { get; set; }

    public int SenderUserId { get; set; }
    [ForeignKey("SenderUserId")]
    [InverseProperty("SentMessages")]
    public virtual User SenderUser { get; set; }

    public int ReceiverUserId { get; set; }
    [ForeignKey("ReceiverUserId")]
    [InverseProperty("ReceivedMessages")]
    public virtual User ReceiverUser { get; set; }

    [StringLength(255)]
    public string? Subject { get; set; }

    [Required]
    public string Content { get; set; }
    public DateTime SentTimestamp { get; set; } = DateTime.UtcNow;
    public DateTime? ReadTimestamp { get; set; }
    public bool IsRead { get; set; } = false;

    public int? ParentMessageId { get; set; } // For threading
    [ForeignKey("ParentMessageId")]
    public virtual Message? ParentMessage { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Property for replies
    public virtual ICollection<Message> Replies { get; set; } = new List<Message>();
}


// --- Inventory & Events Tables ---

public class InventoryCategory
{
    [Key]
    public int InventoryCategoryId { get; set; }

    [Required]
    [StringLength(100)]
    // Consider [Index(IsUnique = true)]
    public string CategoryName { get; set; }
    public string? Description { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<InventoryItem> Items { get; set; } = new List<InventoryItem>();
}

public class InventoryItem
{
    [Key]
    public int ItemId { get; set; }

    [Required]
    [StringLength(255)]
    public string ItemName { get; set; }

    public int InventoryCategoryId { get; set; }
    [ForeignKey("InventoryCategoryId")]
    public virtual InventoryCategory InventoryCategory { get; set; }

    public string? Description { get; set; }

    [Required]
    public int Quantity { get; set; }

    [Column(TypeName = "decimal(10, 2)")]
    public decimal? UnitPrice { get; set; }

    [StringLength(100)]
    public string? Supplier { get; set; }

    [Column(TypeName = "date")]
    public DateTime? PurchaseDate { get; set; }

    [StringLength(100)]
    public string? Location { get; set; } // e.g., "Store Room A"

    [StringLength(100)]
    // Consider [Index(IsUnique = true)] if it's truly unique (e.g. assets, not consumables)
    public string? SerialNumber { get; set; }
    public InventoryItemConditionEnum Condition { get; set; } = InventoryItemConditionEnum.Good;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}

public class EventType
{
    [Key]
    public int EventTypeId { get; set; }

    [Required]
    [StringLength(50)]
    public string TypeName { get; set; } // e.g., 'Holiday', 'School Event'

    [StringLength(7)]
    public string? ColorCode { get; set; } // e.g., '#FF0000'
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<Event> Events { get; set; } = new List<Event>();
}

public class Event
{
    [Key]
    public int EventId { get; set; }

    [Required]
    [StringLength(255)]
    public string EventName { get; set; }

    public int EventTypeId { get; set; }
    [ForeignKey("EventTypeId")]
    public virtual EventType EventType { get; set; }
    public string? Description { get; set; }
    public DateTime StartDate { get; set; } // Using DateTime for full timestamp flexibility
    public DateTime EndDate { get; set; }

    [StringLength(100)]
    public string? Location { get; set; }
    public bool IsHoliday { get; set; } = false;

    public int? OrganizerStaffId { get; set; } // FK to Staff
    [ForeignKey("OrganizerStaffId")]
    public virtual Staff? OrganizerStaff { get; set; }
    public string? Audience { get; set; } // Free text or link via junction table
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}


// --- Hostel (Optional) Tables ---

public class HostelBlock
{
    [Key]
    public int BlockId { get; set; }

    [Required]
    [StringLength(50)]
    // Consider [Index(IsUnique = true)]
    public string BlockName { get; set; } // e.g., "Boys Hostel A"

    public int? WardenStaffId { get; set; } // FK to Staff
    [ForeignKey("WardenStaffId")]
    public virtual Staff? WardenStaff { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<HostelRoom> Rooms { get; set; } = new List<HostelRoom>();
}

public class HostelRoomType
{
    [Key]
    public int RoomTypeId { get; set; }

    [Required]
    [StringLength(50)]
    public string TypeName { get; set; } // e.g., "Single Seater AC"

    [Required]
    public int Capacity { get; set; }
    public string? Description { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // Navigation Properties
    public virtual ICollection<HostelRoom> Rooms { get; set; } = new List<HostelRoom>();
}

public class HostelRoom
{
    [Key]
    public int RoomId { get; set; }

    public int BlockId { get; set; }
    [ForeignKey("BlockId")]
    public virtual HostelBlock Block { get; set; }

    public int RoomTypeId { get; set; }
    [ForeignKey("RoomTypeId")]
    public virtual HostelRoomType RoomType { get; set; }

    [Required]
    [StringLength(20)]
    public string RoomNumber { get; set; }

    [StringLength(10)]
    public string? Floor { get; set; }
    public HostelRoomStatusEnum Status { get; set; } = HostelRoomStatusEnum.Available;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // For UNIQUE (BlockID, RoomNumber), configure in OnModelCreating
    // modelBuilder.Entity<HostelRoom>().HasIndex(hr => new { hr.BlockId, hr.RoomNumber }).IsUnique();

    // Navigation Properties
    public virtual ICollection<HostelAllocation> Allocations { get; set; } = new List<HostelAllocation>();
}

public class HostelAllocation
{
    [Key]
    public int AllocationId { get; set; }

    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }

    public int RoomId { get; set; }
    [ForeignKey("RoomId")]
    public virtual HostelRoom Room { get; set; }

    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime AllocationDate { get; set; }

    [Column(TypeName = "date")]
    public DateTime? VacateDate { get; set; }
    public string? Notes { get; set; }
    public bool IsActive { get; set; } = true;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    // For UNIQUE (StudentID, AcademicYearID), configure in OnModelCreating
    // modelBuilder.Entity<HostelAllocation>().HasIndex(ha => new { ha.StudentId, ha.AcademicYearId }).IsUnique();
    // For UNIQUE (RoomID, AcademicYearID, IsActive=TRUE), this is more complex and might need a filtered index (DB specific) or application-level check.
    // A simpler unique constraint would be (RoomID, AcademicYearID) if only one student can be assigned to a room per year, even if they vacate.
}

```

**Important Considerations for Entity Framework Core:**

1.  **DbContext:** You'll need a `DbContext` class (e.g., `SchoolDbContext`) where you define `DbSet<TEntity>` properties for each of these entity classes.
    ```csharp
    public class SchoolDbContext : DbContext
    {
        public SchoolDbContext(DbContextOptions<SchoolDbContext> options) : base(options) { }

        public DbSet<User> Users { get; set; }
        public DbSet<Role> Roles { get; set; }
        public DbSet<UserRole> UserRoles { get; set; }
        // ... other DbSets for all your entities

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            base.OnModelCreating(modelBuilder);

            // Configure Composite Primary Keys for Join Tables
            modelBuilder.Entity<UserRole>().HasKey(ur => new { ur.UserId, ur.RoleId });
            modelBuilder.Entity<RolePermission>().HasKey(rp => new { rp.RoleId, rp.PermissionId });
            modelBuilder.Entity<StudentParent>().HasKey(sp => new { sp.StudentId, sp.ParentId });
            // ... any other composite keys

            // Configure Unique Constraints (Indexes)
            modelBuilder.Entity<User>().HasIndex(u => u.Username).IsUnique();
            modelBuilder.Entity<User>().HasIndex(u => u.Email).IsUnique();
            // ... other unique constraints as noted in comments above

            // Configure relationships that might be ambiguous or need specific cascade delete behaviors
            // Example for self-referencing Message for replies:
            modelBuilder.Entity<Message>()
                .HasMany(m => m.Replies)
                .WithOne(m => m.ParentMessage)
                .HasForeignKey(m => m.ParentMessageId)
                .OnDelete(DeleteBehavior.Restrict); // Or .ClientSetNull if preferred


            // Example for multiple FKs from Staff to Staff (Reviewer)
             modelBuilder.Entity<StaffPerformanceReview>()
                .HasOne(spr => spr.StaffMember)
                .WithMany(s => s.PerformanceReviewsReceived)
                .HasForeignKey(spr => spr.StaffId)
                .OnDelete(DeleteBehavior.Restrict); // Or another behavior

            modelBuilder.Entity<StaffPerformanceReview>()
                .HasOne(spr => spr.ReviewerStaff)
                .WithMany(s => s.PerformanceReviewsGiven)
                .HasForeignKey(spr => spr.ReviewerStaffId)
                .OnDelete(DeleteBehavior.Restrict); // Or another behavior

            // Similar configurations for Staff (Driver/Attendant in Vehicle), Staff (IssuedBy/ReceivedBy in BookIssue)
            // and StudentTransportAllocation (Pickup/Drop Stops)
        }
    }
    ```

2.  **Navigation Properties:** I've added `virtual ICollection<T>` for collection navigation properties and `virtual T` for single navigation properties. The `virtual` keyword enables lazy loading if you configure it (though explicit loading is often preferred).
3.  **Foreign Key Attributes:** `[ForeignKey("PropertyName")]` is used to explicitly link navigation properties to their scalar foreign key properties.
4.  **Composite Keys for Join Tables:** For tables like `UserRoles`, `RolePermissions`, `StudentParents`, you'll need to configure composite primary keys using the Fluent API in your `DbContext.OnModelCreating` method (as shown in the `UserRole` and `SchoolDbContext` example) or `[PrimaryKey]` attribute in EF Core 6+.
5.  **Unique Constraints:** While SQL has `UNIQUE` constraints, EF Core typically represents these as unique indexes. You can configure these using Fluent API in `OnModelCreating` (e.g., `modelBuilder.Entity<User>().HasIndex(u => u.Username).IsUnique();`) or sometimes with attributes (depending on EF Core version and providers). I've added comments where these are relevant.
6.  **Computed Columns:** For `BalanceAmount` in `StudentFeeInstallment`, if it's truly computed and stored by the database, you can mark the C# property with `[DatabaseGenerated(DatabaseGeneratedOption.Computed)]` and make the setter private. If it's calculated on the fly in C#, use `[NotMapped]` and provide the calculation in the getter.
7.  **Timestamps (`CreatedAt`, `UpdatedAt`):** EF Core can automatically manage these. You might override `SaveChanges`/`SaveChangesAsync` in your `DbContext` or use interceptors. The default `DateTime.UtcNow` initialization is a good starting point.
8.  **InverseProperty Attribute:** For more complex relationships where EF Core might struggle to determine the correct pairing (e.g., multiple relationships between two entities like `Staff` and `StaffPerformanceReview`), `[InverseProperty("NavigationPropertyNameInOtherClass")]` can be very helpful. I've added some examples.

This set of classes provides a strong foundation for your .NET application using Entity Framework Core. Remember to adjust data types, lengths, and constraints precisely to match your database schema if it already exists, or let EF Core generate the schema from this model.