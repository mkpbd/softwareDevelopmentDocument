

Okay, let's generate the MS SQL Server schema (DDL statements) and then I'll re-present the C# .NET entity classes that map to this schema.

---
**MS SQL Server Schema (DDL)**
---

First, let's document the integer mappings for the Enums we'll use in the SQL schema (as comments):

```sql
-- Enum Mappings (for INT columns in SQL):
-- UserTypeEnum: 0:Student, 1:Parent, 2:Teacher, 3:Admin, 4:Staff
-- GenderEnum: 0:Male, 1:Female, 2:Other
-- EnrollmentStatusEnum: 0:Enrolled, 1:Graduated, 2:Withdrawn, 3:Transferred
-- EmploymentStatusEnum: 0:Active, 1:Resigned, 2:Terminated
-- SalaryPaymentStatusEnum: 0:Pending, 1:Paid, 2:Processing
-- DayOfWeekEnum: 0:Monday, 1:Tuesday, 2:Wednesday, 3:Thursday, 4:Friday, 5:Saturday, 6:Sunday
-- AttendanceStatusEnum (Student): 0:Present, 1:Absent, 2:Late, 3:Excused
-- StaffAttendanceStatusEnum: 0:Present, 1:Absent, 2:Late, 3:OnLeave, 4:HalfDay
-- AssignmentStatusEnum: 0:Pending, 1:Submitted, 2:Late, 3:Graded
-- ReportCardStatusEnum: 0:Draft, 1:Published, 2:Archived
-- FeeFrequencyEnum: 0:Monthly, 1:Quarterly, 2:HalfYearly, 3:Annually, 4:OneTime
-- FeeInstallmentStatusEnum: 0:Pending, 1:PartiallyPaid, 2:Paid, 3:Overdue, 4:Waived
-- PaymentModeEnum: 0:Cash, 1:Card, 2:Online, 3:Cheque
-- BookIssueStatusEnum: 0:Issued, 1:Returned, 2:Lost
-- FineStatusEnum: 0:None, 1:Pending, 2:Paid
-- VehicleStatusEnum: 0:Active, 1:Maintenance, 2:Inactive
-- InventoryItemConditionEnum: 0:Good, 1:Fair, 2:NeedsRepair, 3:Damaged
-- HostelRoomStatusEnum: 0:Available, 1:Occupied, 2:Maintenance
```

Now, the `CREATE TABLE` statements:

```sql
-- Core & User Management Tables

CREATE TABLE Roles (
    RoleId INT IDENTITY(1,1) PRIMARY KEY,
    RoleName NVARCHAR(50) NOT NULL UNIQUE,
    Description NVARCHAR(MAX) NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL
);

CREATE TABLE Permissions (
    PermissionId INT IDENTITY(1,1) PRIMARY KEY,
    PermissionName NVARCHAR(100) NOT NULL UNIQUE,
    Description NVARCHAR(MAX) NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL
);

CREATE TABLE Users (
    UserId INT IDENTITY(1,1) PRIMARY KEY,
    Username NVARCHAR(50) NOT NULL UNIQUE,
    PasswordHash NVARCHAR(255) NOT NULL,
    Email NVARCHAR(100) NOT NULL UNIQUE,
    UserType INT NOT NULL, -- 0:Student, 1:Parent, 2:Teacher, 3:Admin, 4:Staff
    IsActive BIT DEFAULT 1 NOT NULL,
    LastLogin DATETIME2 NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL
);
CREATE INDEX IX_Users_Email ON Users(Email);
CREATE INDEX IX_Users_Username ON Users(Username);


CREATE TABLE UserRoles (
    UserId INT NOT NULL,
    RoleId INT NOT NULL,
    PRIMARY KEY (UserId, RoleId),
    FOREIGN KEY (UserId) REFERENCES Users(UserId) ON DELETE CASCADE,
    FOREIGN KEY (RoleId) REFERENCES Roles(RoleId) ON DELETE CASCADE
);
CREATE INDEX IX_UserRoles_RoleId ON UserRoles(RoleId);

CREATE TABLE RolePermissions (
    RoleId INT NOT NULL,
    PermissionId INT NOT NULL,
    PRIMARY KEY (RoleId, PermissionId),
    FOREIGN KEY (RoleId) REFERENCES Roles(RoleId) ON DELETE CASCADE,
    FOREIGN KEY (PermissionId) REFERENCES Permissions(PermissionId) ON DELETE CASCADE
);
CREATE INDEX IX_RolePermissions_PermissionId ON RolePermissions(PermissionId);

-- Student & Staff Information Tables

CREATE TABLE AcademicYears (
    AcademicYearId INT IDENTITY(1,1) PRIMARY KEY,
    YearName NVARCHAR(20) NOT NULL,
    StartDate DATE NOT NULL,
    EndDate DATE NOT NULL,
    IsCurrent BIT DEFAULT 0 NOT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL
);
CREATE INDEX IX_AcademicYears_IsCurrent ON AcademicYears(IsCurrent);

CREATE TABLE Classes (
    ClassId INT IDENTITY(1,1) PRIMARY KEY,
    ClassName NVARCHAR(50) NOT NULL,
    NumericLevel INT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL
);

CREATE TABLE Staff (
    StaffId INT IDENTITY(1,1) PRIMARY KEY,
    UserId INT NULL,
    EmployeeID NVARCHAR(50) NOT NULL UNIQUE,
    FirstName NVARCHAR(50) NOT NULL,
    LastName NVARCHAR(50) NOT NULL,
    DateOfBirth DATE NOT NULL,
    Gender INT NOT NULL, -- 0:Male, 1:Female, 2:Other
    Designation NVARCHAR(100) NOT NULL,
    Department NVARCHAR(100) NULL,
    ContactNumber NVARCHAR(20) NOT NULL,
    Email NVARCHAR(100) NOT NULL UNIQUE,
    Address NVARCHAR(MAX) NULL,
    DateOfJoining DATE NOT NULL,
    Qualification NVARCHAR(MAX) NULL,
    Experience NVARCHAR(MAX) NULL,
    PhotoURL NVARCHAR(255) NULL,
    EmploymentStatus INT DEFAULT 0 NOT NULL, -- 0:Active, 1:Resigned, 2:Terminated
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (UserId) REFERENCES Users(UserId) ON DELETE SET NULL
);
CREATE INDEX IX_Staff_EmployeeID ON Staff(EmployeeID);
CREATE INDEX IX_Staff_Email ON Staff(Email);
CREATE INDEX IX_Staff_UserId ON Staff(UserId);

CREATE TABLE Sections (
    SectionId INT IDENTITY(1,1) PRIMARY KEY,
    SectionName NVARCHAR(50) NOT NULL,
    ClassId INT NOT NULL,
    ClassTeacherId INT NULL,
    Capacity INT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (ClassId) REFERENCES Classes(ClassId) ON DELETE CASCADE,
    FOREIGN KEY (ClassTeacherId) REFERENCES Staff(StaffId) ON DELETE SET NULL
);
CREATE INDEX IX_Sections_ClassId ON Sections(ClassId);
CREATE INDEX IX_Sections_ClassTeacherId ON Sections(ClassTeacherId);

CREATE TABLE Students (
    StudentId INT IDENTITY(1,1) PRIMARY KEY,
    UserId INT NULL,
    AdmissionNumber NVARCHAR(50) NOT NULL UNIQUE,
    FirstName NVARCHAR(50) NOT NULL,
    LastName NVARCHAR(50) NOT NULL,
    DateOfBirth DATE NOT NULL,
    Gender INT NOT NULL, -- 0:Male, 1:Female, 2:Other
    Address NVARCHAR(MAX) NULL,
    ContactNumber NVARCHAR(20) NULL,
    Email NVARCHAR(100) NULL UNIQUE,
    AdmissionDate DATE NOT NULL,
    PhotoURL NVARCHAR(255) NULL,
    BloodGroup NVARCHAR(5) NULL,
    Nationality NVARCHAR(50) NULL,
    PreviousSchool NVARCHAR(100) NULL,
    EnrollmentStatus INT DEFAULT 0 NOT NULL, -- 0:Enrolled, 1:Graduated, 2:Withdrawn, 3:Transferred
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (UserId) REFERENCES Users(UserId) ON DELETE SET NULL
);
CREATE INDEX IX_Students_AdmissionNumber ON Students(AdmissionNumber);
CREATE INDEX IX_Students_Email ON Students(Email);
CREATE INDEX IX_Students_UserId ON Students(UserId);


CREATE TABLE StudentEnrollments (
    EnrollmentId INT IDENTITY(1,1) PRIMARY KEY,
    StudentId INT NOT NULL,
    ClassId INT NOT NULL,
    SectionId INT NOT NULL,
    AcademicYearId INT NOT NULL,
    RollNumber NVARCHAR(20) NULL,
    EnrollmentDate DATE DEFAULT GETUTCDATE() NOT NULL,
    IsActive BIT DEFAULT 1 NOT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UNIQUE (StudentId, AcademicYearId),
    FOREIGN KEY (StudentId) REFERENCES Students(StudentId) ON DELETE CASCADE,
    FOREIGN KEY (ClassId) REFERENCES Classes(ClassId) ON DELETE NO ACTION, -- Avoid cascade if students can be moved
    FOREIGN KEY (SectionId) REFERENCES Sections(SectionId) ON DELETE NO ACTION,
    FOREIGN KEY (AcademicYearId) REFERENCES AcademicYears(AcademicYearId) ON DELETE NO ACTION
);
CREATE INDEX IX_StudentEnrollments_ClassId ON StudentEnrollments(ClassId);
CREATE INDEX IX_StudentEnrollments_SectionId ON StudentEnrollments(SectionId);
CREATE INDEX IX_StudentEnrollments_AcademicYearId ON StudentEnrollments(AcademicYearId);

CREATE TABLE Parents (
    ParentId INT IDENTITY(1,1) PRIMARY KEY,
    UserId INT NULL,
    FirstName NVARCHAR(50) NOT NULL,
    LastName NVARCHAR(50) NOT NULL,
    RelationToStudent NVARCHAR(30) NOT NULL,
    ContactNumber NVARCHAR(20) NOT NULL,
    Email NVARCHAR(100) NOT NULL UNIQUE,
    Address NVARCHAR(MAX) NULL,
    Occupation NVARCHAR(100) NULL,
    PhotoURL NVARCHAR(255) NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (UserId) REFERENCES Users(UserId) ON DELETE SET NULL
);
CREATE INDEX IX_Parents_Email ON Parents(Email);
CREATE INDEX IX_Parents_UserId ON Parents(UserId);


CREATE TABLE StudentParents (
    StudentId INT NOT NULL,
    ParentId INT NOT NULL,
    IsPrimaryContact BIT DEFAULT 0 NOT NULL,
    PRIMARY KEY (StudentId, ParentId),
    FOREIGN KEY (StudentId) REFERENCES Students(StudentId) ON DELETE CASCADE,
    FOREIGN KEY (ParentId) REFERENCES Parents(ParentId) ON DELETE CASCADE
);
CREATE INDEX IX_StudentParents_ParentId ON StudentParents(ParentId);

CREATE TABLE StaffSalaries (
    SalaryId INT IDENTITY(1,1) PRIMARY KEY,
    StaffId INT NOT NULL,
    AcademicYearId INT NOT NULL,
    Month INT NOT NULL,
    Year INT NOT NULL,
    BasicSalary DECIMAL(10,2) NOT NULL,
    Allowances DECIMAL(10,2) DEFAULT 0.00,
    Deductions DECIMAL(10,2) DEFAULT 0.00,
    NetSalary DECIMAL(10,2) NOT NULL,
    PaymentDate DATE NULL,
    PaymentStatus INT DEFAULT 0 NOT NULL, -- 0:Pending, 1:Paid, 2:Processing
    TransactionDetails NVARCHAR(MAX) NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UNIQUE (StaffId, Month, Year),
    FOREIGN KEY (StaffId) REFERENCES Staff(StaffId) ON DELETE CASCADE,
    FOREIGN KEY (AcademicYearId) REFERENCES AcademicYears(AcademicYearId) ON DELETE NO ACTION
);
CREATE INDEX IX_StaffSalaries_AcademicYearId ON StaffSalaries(AcademicYearId);


CREATE TABLE StaffPerformanceReviews (
    ReviewId INT IDENTITY(1,1) PRIMARY KEY,
    StaffId INT NOT NULL, -- Staff being reviewed
    AcademicYearId INT NOT NULL,
    ReviewDate DATE NOT NULL,
    ReviewerStaffId INT NOT NULL, -- Staff who conducted the review
    Rating DECIMAL(3,1) NULL,
    Comments NVARCHAR(MAX) NULL,
    GoalsForNextPeriod NVARCHAR(MAX) NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (StaffId) REFERENCES Staff(StaffId) ON DELETE CASCADE,
    FOREIGN KEY (AcademicYearId) REFERENCES AcademicYears(AcademicYearId) ON DELETE NO ACTION,
    FOREIGN KEY (ReviewerStaffId) REFERENCES Staff(StaffId) ON DELETE NO ACTION -- Avoid self-cascade if reviewer is deleted
);
CREATE INDEX IX_StaffPerformanceReviews_AcademicYearId ON StaffPerformanceReviews(AcademicYearId);
CREATE INDEX IX_StaffPerformanceReviews_ReviewerStaffId ON StaffPerformanceReviews(ReviewerStaffId);

-- Academic & Timetable Tables

CREATE TABLE Subjects (
    SubjectId INT IDENTITY(1,1) PRIMARY KEY,
    SubjectName NVARCHAR(100) NOT NULL,
    SubjectCode NVARCHAR(20) NOT NULL UNIQUE,
    Description NVARCHAR(MAX) NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL
);
CREATE INDEX IX_Subjects_SubjectCode ON Subjects(SubjectCode);

CREATE TABLE ClassSubjects (
    ClassSubjectId INT IDENTITY(1,1) PRIMARY KEY,
    ClassId INT NOT NULL,
    SectionId INT NULL,
    SubjectId INT NOT NULL,
    TeacherId INT NOT NULL,
    AcademicYearId INT NOT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UNIQUE (ClassId, SectionId, SubjectId, AcademicYearId),
    FOREIGN KEY (ClassId) REFERENCES Classes(ClassId) ON DELETE CASCADE,
    FOREIGN KEY (SectionId) REFERENCES Sections(SectionId) ON DELETE NO ACTION, -- Might be null or different cascade path
    FOREIGN KEY (SubjectId) REFERENCES Subjects(SubjectId) ON DELETE CASCADE,
    FOREIGN KEY (TeacherId) REFERENCES Staff(StaffId) ON DELETE NO ACTION, -- Teacher might change, don't cascade delete class subject
    FOREIGN KEY (AcademicYearId) REFERENCES AcademicYears(AcademicYearId) ON DELETE NO ACTION
);
CREATE INDEX IX_ClassSubjects_SectionId ON ClassSubjects(SectionId);
CREATE INDEX IX_ClassSubjects_SubjectId ON ClassSubjects(SubjectId);
CREATE INDEX IX_ClassSubjects_TeacherId ON ClassSubjects(TeacherId);
CREATE INDEX IX_ClassSubjects_AcademicYearId ON ClassSubjects(AcademicYearId);

CREATE TABLE TimetableSlots (
    SlotId INT IDENTITY(1,1) PRIMARY KEY,
    DayOfWeek INT NOT NULL, -- 0:Monday ... 6:Sunday
    StartTime TIME NOT NULL,
    EndTime TIME NOT NULL,
    SlotName NVARCHAR(50) NULL,
    IsBreak BIT DEFAULT 0 NOT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL
);

CREATE TABLE TimetableEntries (
    EntryId INT IDENTITY(1,1) PRIMARY KEY,
    ClassSubjectId INT NOT NULL,
    SlotId INT NOT NULL,
    AcademicYearId INT NOT NULL,
    RoomNumber NVARCHAR(20) NULL,
    SubstituteTeacherId INT NULL,
    Notes NVARCHAR(MAX) NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UNIQUE (ClassSubjectId, SlotId, AcademicYearId),
    FOREIGN KEY (ClassSubjectId) REFERENCES ClassSubjects(ClassSubjectId) ON DELETE CASCADE,
    FOREIGN KEY (SlotId) REFERENCES TimetableSlots(SlotId) ON DELETE CASCADE,
    FOREIGN KEY (AcademicYearId) REFERENCES AcademicYears(AcademicYearId) ON DELETE NO ACTION,
    FOREIGN KEY (SubstituteTeacherId) REFERENCES Staff(StaffId) ON DELETE SET NULL
);
CREATE INDEX IX_TimetableEntries_SlotId ON TimetableEntries(SlotId);
CREATE INDEX IX_TimetableEntries_AcademicYearId ON TimetableEntries(AcademicYearId);
CREATE INDEX IX_TimetableEntries_SubstituteTeacherId ON TimetableEntries(SubstituteTeacherId);


CREATE TABLE StudentAttendance (
    AttendanceId INT IDENTITY(1,1) PRIMARY KEY,
    StudentId INT NOT NULL,
    ClassId INT NOT NULL,
    SectionId INT NOT NULL,
    AcademicYearId INT NOT NULL,
    AttendanceDate DATE NOT NULL,
    TimetableEntryId INT NULL,
    Status INT NOT NULL, -- 0:Present, 1:Absent, 2:Late, 3:Excused
    Remarks NVARCHAR(MAX) NULL,
    RecordedByStaffId INT NOT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UNIQUE (StudentId, AttendanceDate, TimetableEntryId), -- TimetableEntryId can be null, check how SQL handles this for UNIQUE
    FOREIGN KEY (StudentId) REFERENCES Students(StudentId) ON DELETE CASCADE,
    FOREIGN KEY (ClassId) REFERENCES Classes(ClassId) ON DELETE NO ACTION,
    FOREIGN KEY (SectionId) REFERENCES Sections(SectionId) ON DELETE NO ACTION,
    FOREIGN KEY (AcademicYearId) REFERENCES AcademicYears(AcademicYearId) ON DELETE NO ACTION,
    FOREIGN KEY (TimetableEntryId) REFERENCES TimetableEntries(EntryId) ON DELETE SET NULL,
    FOREIGN KEY (RecordedByStaffId) REFERENCES Staff(StaffId) ON DELETE NO ACTION
);
CREATE INDEX IX_StudentAttendance_ClassId ON StudentAttendance(ClassId);
CREATE INDEX IX_StudentAttendance_SectionId ON StudentAttendance(SectionId);
CREATE INDEX IX_StudentAttendance_AcademicYearId ON StudentAttendance(AcademicYearId);
CREATE INDEX IX_StudentAttendance_AttendanceDate ON StudentAttendance(AttendanceDate);
CREATE INDEX IX_StudentAttendance_TimetableEntryId ON StudentAttendance(TimetableEntryId);
CREATE INDEX IX_StudentAttendance_RecordedByStaffId ON StudentAttendance(RecordedByStaffId);


CREATE TABLE StaffAttendance (
    StaffAttendanceId INT IDENTITY(1,1) PRIMARY KEY,
    StaffId INT NOT NULL,
    AttendanceDate DATE NOT NULL,
    Status INT NOT NULL, -- 0:Present, 1:Absent, 2:Late, 3:OnLeave, 4:HalfDay
    CheckInTime TIME NULL,
    CheckOutTime TIME NULL,
    Remarks NVARCHAR(MAX) NULL,
    RecordedByStaffId INT NOT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UNIQUE (StaffId, AttendanceDate),
    FOREIGN KEY (StaffId) REFERENCES Staff(StaffId) ON DELETE CASCADE,
    FOREIGN KEY (RecordedByStaffId) REFERENCES Staff(StaffId) ON DELETE NO ACTION
);
CREATE INDEX IX_StaffAttendance_AttendanceDate ON StaffAttendance(AttendanceDate);
CREATE INDEX IX_StaffAttendance_RecordedByStaffId ON StaffAttendance(RecordedByStaffId);


-- Examination & Academic Records Tables

CREATE TABLE ExamTypes (
    ExamTypeId INT IDENTITY(1,1) PRIMARY KEY,
    TypeName NVARCHAR(50) NOT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL
);

CREATE TABLE Exams (
    ExamId INT IDENTITY(1,1) PRIMARY KEY,
    ExamName NVARCHAR(100) NOT NULL,
    ExamTypeId INT NOT NULL,
    AcademicYearId INT NOT NULL,
    StartDate DATE NOT NULL,
    EndDate DATE NOT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (ExamTypeId) REFERENCES ExamTypes(ExamTypeId) ON DELETE CASCADE,
    FOREIGN KEY (AcademicYearId) REFERENCES AcademicYears(AcademicYearId) ON DELETE NO ACTION
);
CREATE INDEX IX_Exams_ExamTypeId ON Exams(ExamTypeId);
CREATE INDEX IX_Exams_AcademicYearId ON Exams(AcademicYearId);

CREATE TABLE ExamSchedules (
    ExamScheduleId INT IDENTITY(1,1) PRIMARY KEY,
    ExamId INT NOT NULL,
    ClassId INT NOT NULL,
    SectionId INT NULL,
    SubjectId INT NOT NULL,
    ExamDate DATE NOT NULL,
    StartTime TIME NOT NULL,
    EndTime TIME NOT NULL,
    MaxMarks DECIMAL(5,2) NOT NULL,
    PassingMarks DECIMAL(5,2) NOT NULL,
    RoomNumber NVARCHAR(20) NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UNIQUE (ExamId, ClassId, SectionId, SubjectId),
    FOREIGN KEY (ExamId) REFERENCES Exams(ExamId) ON DELETE CASCADE,
    FOREIGN KEY (ClassId) REFERENCES Classes(ClassId) ON DELETE NO ACTION,
    FOREIGN KEY (SectionId) REFERENCES Sections(SectionId) ON DELETE NO ACTION,
    FOREIGN KEY (SubjectId) REFERENCES Subjects(SubjectId) ON DELETE NO ACTION
);
CREATE INDEX IX_ExamSchedules_ClassId ON ExamSchedules(ClassId);
CREATE INDEX IX_ExamSchedules_SectionId ON ExamSchedules(SectionId);
CREATE INDEX IX_ExamSchedules_SubjectId ON ExamSchedules(SubjectId);


CREATE TABLE ExamResults (
    ResultId INT IDENTITY(1,1) PRIMARY KEY,
    ExamScheduleId INT NOT NULL,
    StudentId INT NOT NULL,
    MarksObtained DECIMAL(5,2) NOT NULL,
    Grade NVARCHAR(10) NULL,
    Remarks NVARCHAR(MAX) NULL,
    IsAbsent BIT DEFAULT 0 NOT NULL,
    RecordedByStaffId INT NOT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UNIQUE (ExamScheduleId, StudentId),
    FOREIGN KEY (ExamScheduleId) REFERENCES ExamSchedules(ExamScheduleId) ON DELETE CASCADE,
    FOREIGN KEY (StudentId) REFERENCES Students(StudentId) ON DELETE NO ACTION, -- Student deletion handled by Student table itself
    FOREIGN KEY (RecordedByStaffId) REFERENCES Staff(StaffId) ON DELETE NO ACTION
);
CREATE INDEX IX_ExamResults_StudentId ON ExamResults(StudentId);
CREATE INDEX IX_ExamResults_RecordedByStaffId ON ExamResults(RecordedByStaffId);

CREATE TABLE Assignments (
    AssignmentId INT IDENTITY(1,1) PRIMARY KEY,
    ClassSubjectId INT NOT NULL,
    Title NVARCHAR(255) NOT NULL,
    Description NVARCHAR(MAX) NULL,
    AssignedDate DATE NOT NULL,
    DueDate DATE NOT NULL,
    MaxMarks DECIMAL(5,2) NULL,
    AttachmentURL NVARCHAR(255) NULL,
    TeacherId INT NOT NULL,
    AcademicYearId INT NOT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (ClassSubjectId) REFERENCES ClassSubjects(ClassSubjectId) ON DELETE CASCADE,
    FOREIGN KEY (TeacherId) REFERENCES Staff(StaffId) ON DELETE NO ACTION,
    FOREIGN KEY (AcademicYearId) REFERENCES AcademicYears(AcademicYearId) ON DELETE NO ACTION
);
CREATE INDEX IX_Assignments_TeacherId ON Assignments(TeacherId);
CREATE INDEX IX_Assignments_AcademicYearId ON Assignments(AcademicYearId);

CREATE TABLE StudentAssignments (
    StudentAssignmentId INT IDENTITY(1,1) PRIMARY KEY,
    AssignmentId INT NOT NULL,
    StudentId INT NOT NULL,
    SubmissionDate DATETIME2 NULL,
    SubmittedFileURL NVARCHAR(255) NULL,
    MarksObtained DECIMAL(5,2) NULL,
    Feedback NVARCHAR(MAX) NULL,
    Status INT DEFAULT 0 NOT NULL, -- 0:Pending, 1:Submitted, 2:Late, 3:Graded
    GradedByStaffId INT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UNIQUE (AssignmentId, StudentId),
    FOREIGN KEY (AssignmentId) REFERENCES Assignments(AssignmentId) ON DELETE CASCADE,
    FOREIGN KEY (StudentId) REFERENCES Students(StudentId) ON DELETE NO ACTION,
    FOREIGN KEY (GradedByStaffId) REFERENCES Staff(StaffId) ON DELETE SET NULL
);
CREATE INDEX IX_StudentAssignments_StudentId ON StudentAssignments(StudentId);
CREATE INDEX IX_StudentAssignments_GradedByStaffId ON StudentAssignments(GradedByStaffId);

CREATE TABLE GradeScales (
    GradeScaleId INT IDENTITY(1,1) PRIMARY KEY,
    GradeName NVARCHAR(10) NOT NULL,
    MinPercentage DECIMAL(5,2) NOT NULL,
    MaxPercentage DECIMAL(5,2) NOT NULL,
    Description NVARCHAR(50) NULL,
    AcademicYearId INT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (AcademicYearId) REFERENCES AcademicYears(AcademicYearId) ON DELETE SET NULL
);
CREATE INDEX IX_GradeScales_AcademicYearId ON GradeScales(AcademicYearId);


CREATE TABLE ReportCards (
    ReportCardId INT IDENTITY(1,1) PRIMARY KEY,
    StudentId INT NOT NULL,
    AcademicYearId INT NOT NULL,
    ClassId INT NOT NULL,
    SectionId INT NOT NULL,
    TermName NVARCHAR(50) NOT NULL,
    OverallPercentage DECIMAL(5,2) NULL,
    OverallGrade NVARCHAR(10) NULL,
    TeacherRemarks NVARCHAR(MAX) NULL,
    PrincipalRemarks NVARCHAR(MAX) NULL,
    GeneratedDate DATE NOT NULL,
    PublishedDate DATE NULL,
    Status INT DEFAULT 0 NOT NULL, -- 0:Draft, 1:Published, 2:Archived
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (StudentId) REFERENCES Students(StudentId) ON DELETE CASCADE,
    FOREIGN KEY (AcademicYearId) REFERENCES AcademicYears(AcademicYearId) ON DELETE NO ACTION,
    FOREIGN KEY (ClassId) REFERENCES Classes(ClassId) ON DELETE NO ACTION,
    FOREIGN KEY (SectionId) REFERENCES Sections(SectionId) ON DELETE NO ACTION
);
CREATE INDEX IX_ReportCards_AcademicYearId ON ReportCards(AcademicYearId);
CREATE INDEX IX_ReportCards_ClassId ON ReportCards(ClassId);
CREATE INDEX IX_ReportCards_SectionId ON ReportCards(SectionId);

-- Fee Management Tables

CREATE TABLE FeeCategories (
    FeeCategoryId INT IDENTITY(1,1) PRIMARY KEY,
    CategoryName NVARCHAR(100) NOT NULL UNIQUE,
    Description NVARCHAR(MAX) NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL
);

CREATE TABLE FeeStructures (
    FeeStructureId INT IDENTITY(1,1) PRIMARY KEY,
    FeeCategoryId INT NOT NULL,
    ClassId INT NULL,
    AcademicYearId INT NOT NULL,
    Amount DECIMAL(10,2) NOT NULL,
    Frequency INT NOT NULL, -- 0:Monthly, 1:Quarterly, 2:HalfYearly, 3:Annually, 4:OneTime
    DueDatePattern NVARCHAR(50) NULL,
    LateFeePerDay DECIMAL(8,2) DEFAULT 0.00,
    Description NVARCHAR(MAX) NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UNIQUE (FeeCategoryId, ClassId, AcademicYearId, Frequency),
    FOREIGN KEY (FeeCategoryId) REFERENCES FeeCategories(FeeCategoryId) ON DELETE CASCADE,
    FOREIGN KEY (ClassId) REFERENCES Classes(ClassId) ON DELETE SET NULL,
    FOREIGN KEY (AcademicYearId) REFERENCES AcademicYears(AcademicYearId) ON DELETE NO ACTION
);
CREATE INDEX IX_FeeStructures_ClassId ON FeeStructures(ClassId);
CREATE INDEX IX_FeeStructures_AcademicYearId ON FeeStructures(AcademicYearId);

CREATE TABLE StudentFeeInstallments (
    InstallmentId INT IDENTITY(1,1) PRIMARY KEY,
    StudentId INT NOT NULL,
    FeeStructureId INT NOT NULL,
    AcademicYearId INT NOT NULL,
    InstallmentName NVARCHAR(100) NOT NULL,
    AmountDue DECIMAL(10,2) NOT NULL,
    DueDate DATE NOT NULL,
    AmountPaid DECIMAL(10,2) DEFAULT 0.00,
    WaiverAmount DECIMAL(10,2) DEFAULT 0.00,
    LateFeeApplied DECIMAL(8,2) DEFAULT 0.00,
    BalanceAmount AS (AmountDue + LateFeeApplied - AmountPaid - WaiverAmount) PERSISTED,
    Status INT DEFAULT 0 NOT NULL, -- 0:Pending, 1:PartiallyPaid, 2:Paid, 3:Overdue, 4:Waived
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (StudentId) REFERENCES Students(StudentId) ON DELETE CASCADE,
    FOREIGN KEY (FeeStructureId) REFERENCES FeeStructures(FeeStructureId) ON DELETE NO ACTION,
    FOREIGN KEY (AcademicYearId) REFERENCES AcademicYears(AcademicYearId) ON DELETE NO ACTION
);
CREATE INDEX IX_StudentFeeInstallments_FeeStructureId ON StudentFeeInstallments(FeeStructureId);
CREATE INDEX IX_StudentFeeInstallments_AcademicYearId ON StudentFeeInstallments(AcademicYearId);
CREATE INDEX IX_StudentFeeInstallments_DueDate ON StudentFeeInstallments(DueDate);


CREATE TABLE FeePayments (
    PaymentId INT IDENTITY(1,1) PRIMARY KEY,
    InstallmentId INT NOT NULL,
    StudentId INT NOT NULL,
    PaymentDate DATE NOT NULL,
    AmountPaid DECIMAL(10,2) NOT NULL,
    PaymentMode INT NOT NULL, -- 0:Cash, 1:Card, 2:Online, 3:Cheque
    TransactionID NVARCHAR(100) NULL,
    ReceiptNumber NVARCHAR(50) NOT NULL UNIQUE,
    Notes NVARCHAR(MAX) NULL,
    CollectedByStaffId INT NOT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (InstallmentId) REFERENCES StudentFeeInstallments(InstallmentId) ON DELETE NO ACTION,
    FOREIGN KEY (StudentId) REFERENCES Students(StudentId) ON DELETE NO ACTION, -- Student deleted elsewhere
    FOREIGN KEY (CollectedByStaffId) REFERENCES Staff(StaffId) ON DELETE NO ACTION
);
CREATE INDEX IX_FeePayments_StudentId ON FeePayments(StudentId);
CREATE INDEX IX_FeePayments_CollectedByStaffId ON FeePayments(CollectedByStaffId);
CREATE INDEX IX_FeePayments_ReceiptNumber ON FeePayments(ReceiptNumber);

-- Library Tables

CREATE TABLE BookCategories (
    BookCategoryId INT IDENTITY(1,1) PRIMARY KEY,
    CategoryName NVARCHAR(100) NOT NULL UNIQUE,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL
);

CREATE TABLE LibraryBooks (
    BookId INT IDENTITY(1,1) PRIMARY KEY,
    ISBN NVARCHAR(20) NOT NULL UNIQUE,
    Title NVARCHAR(255) NOT NULL,
    Author NVARCHAR(255) NOT NULL,
    Publisher NVARCHAR(100) NULL,
    PublicationYear INT NULL,
    Edition NVARCHAR(50) NULL,
    BookCategoryId INT NOT NULL,
    TotalCopies INT DEFAULT 1 NOT NULL,
    AvailableCopies INT DEFAULT 1 NOT NULL,
    ShelfLocation NVARCHAR(50) NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (BookCategoryId) REFERENCES BookCategories(BookCategoryId) ON DELETE CASCADE
);
CREATE INDEX IX_LibraryBooks_ISBN ON LibraryBooks(ISBN);
CREATE INDEX IX_LibraryBooks_Title ON LibraryBooks(Title);
CREATE INDEX IX_LibraryBooks_Author ON LibraryBooks(Author);
CREATE INDEX IX_LibraryBooks_BookCategoryId ON LibraryBooks(BookCategoryId);

CREATE TABLE BookIssues (
    IssueId INT IDENTITY(1,1) PRIMARY KEY,
    BookId INT NOT NULL,
    UserId INT NOT NULL,
    IssueDate DATE NOT NULL,
    DueDate DATE NOT NULL,
    ReturnDate DATE NULL,
    FineAmount DECIMAL(8,2) DEFAULT 0.00,
    FineStatus INT DEFAULT 0 NOT NULL, -- 0:None, 1:Pending, 2:Paid
    IssuedByStaffId INT NOT NULL,
    ReceivedByStaffId INT NULL,
    Status INT DEFAULT 0 NOT NULL, -- 0:Issued, 1:Returned, 2:Lost
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (BookId) REFERENCES LibraryBooks(BookId) ON DELETE CASCADE,
    FOREIGN KEY (UserId) REFERENCES Users(UserId) ON DELETE CASCADE,
    FOREIGN KEY (IssuedByStaffId) REFERENCES Staff(StaffId) ON DELETE NO ACTION,
    FOREIGN KEY (ReceivedByStaffId) REFERENCES Staff(StaffId) ON DELETE NO ACTION
);
CREATE INDEX IX_BookIssues_UserId ON BookIssues(UserId);
CREATE INDEX IX_BookIssues_IssueDate ON BookIssues(IssueDate);
CREATE INDEX IX_BookIssues_DueDate ON BookIssues(DueDate);
CREATE INDEX IX_BookIssues_IssuedByStaffId ON BookIssues(IssuedByStaffId);
CREATE INDEX IX_BookIssues_ReceivedByStaffId ON BookIssues(ReceivedByStaffId);

-- Transport Tables

CREATE TABLE TransportRoutes (
    RouteId INT IDENTITY(1,1) PRIMARY KEY,
    RouteName NVARCHAR(100) NOT NULL UNIQUE,
    RouteDescription NVARCHAR(MAX) NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL
);

CREATE TABLE RouteStops (
    StopId INT IDENTITY(1,1) PRIMARY KEY,
    RouteId INT NOT NULL,
    StopName NVARCHAR(100) NOT NULL,
    Latitude DECIMAL(10,8) NULL,
    Longitude DECIMAL(11,8) NULL,
    PickupTime TIME NULL,
    DropTime TIME NULL,
    SequenceOrder INT NOT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (RouteId) REFERENCES TransportRoutes(RouteId) ON DELETE CASCADE
);
CREATE INDEX IX_RouteStops_RouteId ON RouteStops(RouteId);


CREATE TABLE Vehicles (
    VehicleId INT IDENTITY(1,1) PRIMARY KEY,
    VehicleNumber NVARCHAR(20) NOT NULL UNIQUE,
    VehicleType NVARCHAR(50) DEFAULT 'Bus',
    Capacity INT NOT NULL,
    DriverStaffId INT NULL,
    AttendantStaffId INT NULL,
    GPSDeviceID NVARCHAR(50) NULL,
    Status INT DEFAULT 0 NOT NULL, -- 0:Active, 1:Maintenance, 2:Inactive
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (DriverStaffId) REFERENCES Staff(StaffId) ON DELETE SET NULL,
    FOREIGN KEY (AttendantStaffId) REFERENCES Staff(StaffId) ON DELETE SET NULL
);
CREATE INDEX IX_Vehicles_VehicleNumber ON Vehicles(VehicleNumber);
CREATE INDEX IX_Vehicles_DriverStaffId ON Vehicles(DriverStaffId);
CREATE INDEX IX_Vehicles_AttendantStaffId ON Vehicles(AttendantStaffId);

CREATE TABLE VehicleRouteAssignments (
    AssignmentID INT IDENTITY(1,1) PRIMARY KEY,
    VehicleId INT NOT NULL,
    RouteId INT NOT NULL,
    AcademicYearId INT NOT NULL,
    StartDate DATE NOT NULL,
    EndDate DATE NULL,
    IsActive BIT DEFAULT 1 NOT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UNIQUE (VehicleId, RouteId, AcademicYearId),
    FOREIGN KEY (VehicleId) REFERENCES Vehicles(VehicleId) ON DELETE CASCADE,
    FOREIGN KEY (RouteId) REFERENCES TransportRoutes(RouteId) ON DELETE CASCADE,
    FOREIGN KEY (AcademicYearId) REFERENCES AcademicYears(AcademicYearId) ON DELETE NO ACTION
);
CREATE INDEX IX_VehicleRouteAssignments_RouteId ON VehicleRouteAssignments(RouteId);
CREATE INDEX IX_VehicleRouteAssignments_AcademicYearId ON VehicleRouteAssignments(AcademicYearId);

CREATE TABLE StudentTransportAllocations (
    AllocationID INT IDENTITY(1,1) PRIMARY KEY,
    StudentId INT NOT NULL,
    VehicleRouteAssignmentID INT NOT NULL,
    PickupStopId INT NOT NULL,
    DropStopId INT NOT NULL,
    AcademicYearId INT NOT NULL,
    StartDate DATE NOT NULL,
    EndDate DATE NULL,
    IsActive BIT DEFAULT 1 NOT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UNIQUE (StudentId, AcademicYearId),
    FOREIGN KEY (StudentId) REFERENCES Students(StudentId) ON DELETE CASCADE,
    FOREIGN KEY (VehicleRouteAssignmentID) REFERENCES VehicleRouteAssignments(AssignmentID) ON DELETE NO ACTION, -- Deleting assignment handled separately
    FOREIGN KEY (PickupStopId) REFERENCES RouteStops(StopId) ON DELETE NO ACTION,
    FOREIGN KEY (DropStopId) REFERENCES RouteStops(StopId) ON DELETE NO ACTION,
    FOREIGN KEY (AcademicYearId) REFERENCES AcademicYears(AcademicYearId) ON DELETE NO ACTION
);
CREATE INDEX IX_StudentTransportAllocations_VehicleRouteAssignmentID ON StudentTransportAllocations(VehicleRouteAssignmentID);
CREATE INDEX IX_StudentTransportAllocations_PickupStopId ON StudentTransportAllocations(PickupStopId);
CREATE INDEX IX_StudentTransportAllocations_DropStopId ON StudentTransportAllocations(DropStopId);
CREATE INDEX IX_StudentTransportAllocations_AcademicYearId ON StudentTransportAllocations(AcademicYearId);

-- Communication Tables

CREATE TABLE Announcements (
    AnnouncementId INT IDENTITY(1,1) PRIMARY KEY,
    Title NVARCHAR(255) NOT NULL,
    Content NVARCHAR(MAX) NOT NULL,
    PublishDate DATETIME2 NOT NULL,
    ExpiryDate DATETIME2 NULL,
    PostedByUserId INT NOT NULL,
    AttachmentURL NVARCHAR(255) NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (PostedByUserId) REFERENCES Users(UserId) ON DELETE NO ACTION
);
CREATE INDEX IX_Announcements_PublishDate ON Announcements(PublishDate);
CREATE INDEX IX_Announcements_PostedByUserId ON Announcements(PostedByUserId);

CREATE TABLE AnnouncementAudiences (
    AnnouncementId INT NOT NULL,
    RoleId INT NULL,
    ClassId INT NULL,
    SectionId INT NULL,
    -- A better PK might be (AnnouncementId, TargetType (enum as int), TargetTypeId)
    -- For this structure, we assume one row can target a combination.
    -- If only one target type per row, then PK could be (AnnouncementId, RoleId) OR (AnnouncementId, ClassId) etc.
    -- This needs clarification based on exact requirement. For now, making it a composite of all:
    PRIMARY KEY (AnnouncementId, RoleId, ClassId, SectionId), -- This is problematic if some are NULL.
    -- A more robust junction would have its own ID or a structure allowing one type of target per row.
    -- Let's assume for now that a single AnnouncementAudience row targets ONE specific entity or null
    -- A better approach would be:
    -- AudienceId INT IDENTITY(1,1) PRIMARY KEY,
    -- AnnouncementId INT NOT NULL,
    -- TargetType INT NOT NULL, -- 0:Role, 1:Class, 2:Section
    -- TargetId INT NOT NULL
    -- For simplicity with current model, let's make this very flexible but potentially less normalized:
    -- This PK is NOT ideal if multiple fields can be null.
    -- Consider separate junction tables or a different structure if targeting is complex.
    FOREIGN KEY (AnnouncementId) REFERENCES Announcements(AnnouncementId) ON DELETE CASCADE,
    FOREIGN KEY (RoleId) REFERENCES Roles(RoleId) ON DELETE SET NULL,
    FOREIGN KEY (ClassId) REFERENCES Classes(ClassId) ON DELETE SET NULL,
    FOREIGN KEY (SectionId) REFERENCES Sections(SectionId) ON DELETE SET NULL
);
-- Note: The PK for AnnouncementAudiences might need refinement based on how granular the targeting is.
-- If a single audience record can target a Role AND a Class AND a Section, the PK (AnnId, RoleId, ClassId, SectionId) might work if none are ever truly null in that combo.
-- If RoleId, ClassId, SectionId are mutually exclusive for a single audience entry, a different structure is needed.
-- For now, I'll leave it as is, but it's a point of attention.
CREATE INDEX IX_AnnouncementAudiences_RoleId ON AnnouncementAudiences(RoleId);
CREATE INDEX IX_AnnouncementAudiences_ClassId ON AnnouncementAudiences(ClassId);
CREATE INDEX IX_AnnouncementAudiences_SectionId ON AnnouncementAudiences(SectionId);


CREATE TABLE Messages (
    MessageId INT IDENTITY(1,1) PRIMARY KEY,
    SenderUserId INT NOT NULL,
    ReceiverUserId INT NOT NULL,
    Subject NVARCHAR(255) NULL,
    Content NVARCHAR(MAX) NOT NULL,
    SentTimestamp DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    ReadTimestamp DATETIME2 NULL,
    IsRead BIT DEFAULT 0 NOT NULL,
    ParentMessageId INT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (SenderUserId) REFERENCES Users(UserId) ON DELETE NO ACTION,
    FOREIGN KEY (ReceiverUserId) REFERENCES Users(UserId) ON DELETE NO ACTION,
    FOREIGN KEY (ParentMessageId) REFERENCES Messages(MessageId) ON DELETE NO ACTION -- No cascade for replies
);
CREATE INDEX IX_Messages_SenderUserId ON Messages(SenderUserId);
CREATE INDEX IX_Messages_ReceiverUserId ON Messages(ReceiverUserId);
CREATE INDEX IX_Messages_ParentMessageId ON Messages(ParentMessageId);


-- Inventory & Events Tables

CREATE TABLE InventoryCategories (
    InventoryCategoryId INT IDENTITY(1,1) PRIMARY KEY,
    CategoryName NVARCHAR(100) NOT NULL UNIQUE,
    Description NVARCHAR(MAX) NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL
);

CREATE TABLE InventoryItems (
    ItemId INT IDENTITY(1,1) PRIMARY KEY,
    ItemName NVARCHAR(255) NOT NULL,
    InventoryCategoryId INT NOT NULL,
    Description NVARCHAR(MAX) NULL,
    Quantity INT NOT NULL,
    UnitPrice DECIMAL(10,2) NULL,
    Supplier NVARCHAR(100) NULL,
    PurchaseDate DATE NULL,
    Location NVARCHAR(100) NULL,
    SerialNumber NVARCHAR(100) NULL UNIQUE,
    Condition INT DEFAULT 0 NOT NULL, -- 0:Good, 1:Fair, 2:NeedsRepair, 3:Damaged
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (InventoryCategoryId) REFERENCES InventoryCategories(InventoryCategoryId) ON DELETE CASCADE
);
CREATE INDEX IX_InventoryItems_InventoryCategoryId ON InventoryItems(InventoryCategoryId);
CREATE INDEX IX_InventoryItems_SerialNumber ON InventoryItems(SerialNumber);


CREATE TABLE EventTypes (
    EventTypeId INT IDENTITY(1,1) PRIMARY KEY,
    TypeName NVARCHAR(50) NOT NULL,
    ColorCode NVARCHAR(7) NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL
);

CREATE TABLE Events (
    EventId INT IDENTITY(1,1) PRIMARY KEY,
    EventName NVARCHAR(255) NOT NULL,
    EventTypeId INT NOT NULL,
    Description NVARCHAR(MAX) NULL,
    StartDate DATETIME2 NOT NULL,
    EndDate DATETIME2 NOT NULL,
    Location NVARCHAR(100) NULL,
    IsHoliday BIT DEFAULT 0 NOT NULL,
    OrganizerStaffId INT NULL,
    Audience NVARCHAR(MAX) NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (EventTypeId) REFERENCES EventTypes(EventTypeId) ON DELETE CASCADE,
    FOREIGN KEY (OrganizerStaffId) REFERENCES Staff(StaffId) ON DELETE SET NULL
);
CREATE INDEX IX_Events_EventTypeId ON Events(EventTypeId);
CREATE INDEX IX_Events_StartDate ON Events(StartDate);
CREATE INDEX IX_Events_OrganizerStaffId ON Events(OrganizerStaffId);

-- Hostel (Optional) Tables

CREATE TABLE HostelBlocks (
    BlockId INT IDENTITY(1,1) PRIMARY KEY,
    BlockName NVARCHAR(50) NOT NULL UNIQUE,
    WardenStaffId INT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    FOREIGN KEY (WardenStaffId) REFERENCES Staff(StaffId) ON DELETE SET NULL
);
CREATE INDEX IX_HostelBlocks_WardenStaffId ON HostelBlocks(WardenStaffId);

CREATE TABLE HostelRoomTypes (
    RoomTypeId INT IDENTITY(1,1) PRIMARY KEY,
    TypeName NVARCHAR(50) NOT NULL,
    Capacity INT NOT NULL,
    Description NVARCHAR(MAX) NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL
);

CREATE TABLE HostelRooms (
    RoomId INT IDENTITY(1,1) PRIMARY KEY,
    BlockId INT NOT NULL,
    RoomTypeId INT NOT NULL,
    RoomNumber NVARCHAR(20) NOT NULL,
    Floor NVARCHAR(10) NULL,
    Status INT DEFAULT 0 NOT NULL, -- 0:Available, 1:Occupied, 2:Maintenance
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UNIQUE (BlockId, RoomNumber),
    FOREIGN KEY (BlockId) REFERENCES HostelBlocks(BlockId) ON DELETE CASCADE,
    FOREIGN KEY (RoomTypeId) REFERENCES HostelRoomTypes(RoomTypeId) ON DELETE CASCADE
);
CREATE INDEX IX_HostelRooms_RoomTypeId ON HostelRooms(RoomTypeId);


CREATE TABLE HostelAllocations (
    AllocationID INT IDENTITY(1,1) PRIMARY KEY,
    StudentId INT NOT NULL,
    RoomId INT NOT NULL,
    AcademicYearId INT NOT NULL,
    AllocationDate DATE NOT NULL,
    VacateDate DATE NULL,
    Notes NVARCHAR(MAX) NULL,
    IsActive BIT DEFAULT 1 NOT NULL,
    CreatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UpdatedAt DATETIME2 DEFAULT GETUTCDATE() NOT NULL,
    UNIQUE (StudentId, AcademicYearId),
    -- UNIQUE (RoomId, AcademicYearId, IsActive) -- This requires a filtered index for IsActive=TRUE, complex for generic SQL
    FOREIGN KEY (StudentId) REFERENCES Students(StudentId) ON DELETE CASCADE,
    FOREIGN KEY (RoomId) REFERENCES HostelRooms(RoomId) ON DELETE NO ACTION,
    FOREIGN KEY (AcademicYearId) REFERENCES AcademicYears(AcademicYearId) ON DELETE NO ACTION
);
CREATE INDEX IX_HostelAllocations_RoomId ON HostelAllocations(RoomId);
CREATE INDEX IX_HostelAllocations_AcademicYearId ON HostelAllocations(AcademicYearId);

```

**Notes on the SQL Schema:**
*   **Enums:** Stored as `INT`. The mappings are provided as comments at the beginning.
*   **Timestamps:** `CreatedAt` and `UpdatedAt` use `DATETIME2` and `GETUTCDATE()` as default. `UpdatedAt` would ideally be managed by triggers in a production environment for automatic updates on row modification.
*   **ON DELETE Clauses:** Carefully chosen (e.g., `CASCADE`, `SET NULL`, `NO ACTION`). These depend heavily on business rules. `NO ACTION` (the default if not specified for many DBs, but explicit here for clarity) means the operation will fail if related rows exist.
*   **Unique Constraints:** Added where specified in the model.
*   **Indexes:** Basic indexes are added for foreign keys and some common lookup columns. More specific indexing strategies would depend on query patterns.
*   **`StudentFeeInstallments.BalanceAmount`:** Implemented as a `PERSISTED` computed column.
*   **`AnnouncementAudiences` Primary Key:** This table's PK is tricky if `RoleId`, `ClassId`, `SectionId` can be NULL in combination. A surrogate key (`AudienceId INT IDENTITY PRIMARY KEY`) and then individual columns for `TargetType` and `TargetID` might be a more robust design for complex targeting. I've kept it close to the original request but highlighted the potential issue.
*   **`StudentAttendance.TimetableEntryId` Uniqueness:** SQL Server's `UNIQUE` constraint behavior with `NULL` values needs to be considered. A filtered unique index might be needed if `TimetableEntryId` can be `NULL` and you still want uniqueness for non-null values paired with `StudentId` and `AttendanceDate`.

---
**C# .NET Entity Classes (Aligned with the SQL Schema)**
---

The C# entity classes provided in the previous response are largely compatible. The main change is to ensure that `enum` properties in C# will be mapped to `INT` columns in the database by Entity Framework Core by default. Data annotations like `[Column(TypeName = "date")]` and `[Column(TypeName = "time")]` for `DateTime` (just date part) and `TimeSpan` respectively are correct. `[Column(TypeName = "decimal(x,y)")]` is also correct.

Here's a re-confirmation of the C# structure, which should work with the SQL schema above when using EF Core.

```csharp
// Add necessary using statements:
// using System;
// using System.Collections.Generic;
// using System.ComponentModel.DataAnnotations;
// using System.ComponentModel.DataAnnotations.Schema;

// ------------ ENUMS (Remain the same as your previous definition) ------------
public enum UserTypeEnum { Student, Parent, Teacher, Admin, Staff }
public enum GenderEnum { Male, Female, Other }
public enum EnrollmentStatusEnum { Enrolled, Graduated, Withdrawn, Transferred }
public enum EmploymentStatusEnum { Active, Resigned, Terminated }
public enum SalaryPaymentStatusEnum { Pending, Paid, Processing }
public enum DayOfWeekEnum { Monday, Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday }
public enum AttendanceStatusEnum { Present, Absent, Late, Excused }
public enum StaffAttendanceStatusEnum { Present, Absent, Late, OnLeave, HalfDay }
public enum AssignmentStatusEnum { Pending, Submitted, Late, Graded }
public enum ReportCardStatusEnum { Draft, Published, Archived }
public enum FeeFrequencyEnum { Monthly, Quarterly, HalfYearly, Annually, OneTime }
public enum FeeInstallmentStatusEnum { Pending, PartiallyPaid, Paid, Overdue, Waived }
public enum PaymentModeEnum { Cash, Card, Online, Cheque }
public enum BookIssueStatusEnum { Issued, Returned, Lost }
public enum FineStatusEnum { None, Pending, Paid }
public enum VehicleStatusEnum { Active, Maintenance, Inactive }
public enum InventoryItemConditionEnum { Good, Fair, NeedsRepair, Damaged }
public enum HostelRoomStatusEnum { Available, Occupied, Maintenance }

// ------------ ENTITY CLASSES (Largely the same as your previous definition) ------------

// --- Core & User Management Tables ---
public class User
{
    [Key]
    public int UserId { get; set; }

    [Required]
    [StringLength(50)]
    public string Username { get; set; }

    [Required]
    [StringLength(255)]
    public string PasswordHash { get; set; }

    [Required]
    [StringLength(100)]
    [EmailAddress]
    public string Email { get; set; }

    [Required]
    public UserTypeEnum UserType { get; set; } // Mapped to INT

    public bool IsActive { get; set; } = true;
    public DateTime? LastLogin { get; set; } // DATETIME2 in SQL
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow; // DATETIME2
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow; // DATETIME2

    // Navigation Properties
    public virtual ICollection<UserRole> UserRoles { get; set; } = new List<UserRole>();
    public virtual Student? StudentProfile { get; set; }
    public virtual Parent? ParentProfile { get; set; }
    public virtual Staff? StaffProfile { get; set; }
    public virtual ICollection<Announcement> PostedAnnouncements { get; set; } = new List<Announcement>();
    public virtual ICollection<Message> SentMessages { get; set; } = new List<Message>();
    public virtual ICollection<Message> ReceivedMessages { get; set; } = new List<Message>();
    public virtual ICollection<BookIssue> BookIssues { get; set; } = new List<BookIssue>();
}

public class Role
{
    [Key]
    public int RoleId { get; set; }

    [Required]
    [StringLength(50)]
    public string RoleName { get; set; }

    [Column(TypeName = "nvarchar(MAX)")]
    public string? Description { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    public virtual ICollection<UserRole> UserRoles { get; set; } = new List<UserRole>();
    public virtual ICollection<RolePermission> RolePermissions { get; set; } = new List<RolePermission>();
    public virtual ICollection<AnnouncementAudience> AnnouncementAudiences { get; set; } = new List<AnnouncementAudience>();
}

public class UserRole // Junction
{
    public int UserId { get; set; }
    [ForeignKey("UserId")]
    public virtual User User { get; set; }

    public int RoleId { get; set; }
    [ForeignKey("RoleId")]
    public virtual Role Role { get; set; }
}

public class Permission
{
    [Key]
    public int PermissionId { get; set; }

    [Required]
    [StringLength(100)]
    public string PermissionName { get; set; }

    [Column(TypeName = "nvarchar(MAX)")]
    public string? Description { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    public virtual ICollection<RolePermission> RolePermissions { get; set; } = new List<RolePermission>();
}

public class RolePermission // Junction
{
    public int RoleId { get; set; }
    [ForeignKey("RoleId")]
    public virtual Role Role { get; set; }

    public int PermissionId { get; set; }
    [ForeignKey("PermissionId")]
    public virtual Permission Permission { get; set; }
}


// --- Student & Staff Information Tables ---
public class AcademicYear
{
    [Key]
    public int AcademicYearId { get; set; }

    [Required]
    [StringLength(20)]
    public string YearName { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime StartDate { get; set; }

    [Required]
    [Column(TypeName = "date")]
    public DateTime EndDate { get; set; }

    public bool IsCurrent { get; set; } = false;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;

    public virtual ICollection<StudentEnrollment> StudentEnrollments { get; set; } = new List<StudentEnrollment>();
    public virtual ICollection<StaffSalary> StaffSalaries { get; set; } = new List<StaffSalary>();
    // ... other navigation properties as previously defined
}

public class Class
{
    [Key]
    public int ClassId { get; set; }
    [Required]
    [StringLength(50)]
    public string ClassName { get; set; }
    public int? NumericLevel { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    // ... navigation properties
}

public class Staff
{
    [Key]
    public int StaffId { get; set; }
    public int? UserId { get; set; }
    [ForeignKey("UserId")]
    public virtual User? User { get; set; }

    [Required]
    [StringLength(50)]
    public string EmployeeID { get; set; }
    // ... other properties like FirstName, LastName, etc.
    [Required]
    public GenderEnum Gender { get; set; } // Mapped to INT

    [Required]
    [Column(TypeName = "date")]
    public DateTime DateOfJoining { get; set; }

    public EmploymentStatusEnum EmploymentStatus { get; set; } = EmploymentStatusEnum.Active; // Mapped to INT

    [Column(TypeName = "nvarchar(MAX)")]
    public string? Address { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Qualification { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Experience { get; set; }

    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    // ... navigation properties
}

public class Section
{
    [Key]
    public int SectionId { get; set; }
    [Required]
    [StringLength(50)]
    public string SectionName { get; set; }
    public int ClassId { get; set; }
    [ForeignKey("ClassId")]
    public virtual Class Class { get; set; }
    public int? ClassTeacherId { get; set; }
    [ForeignKey("ClassTeacherId")]
    public virtual Staff? ClassTeacher { get; set; }
    public int? Capacity { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    // ... navigation properties
}

public class Student
{
    [Key]
    public int StudentId { get; set; }
    public int? UserId { get; set; }
    [ForeignKey("UserId")]
    public virtual User? User { get; set; }
    [Required]
    [StringLength(50)]
    public string AdmissionNumber { get; set; }
    // ... other properties
    [Required]
    public GenderEnum Gender { get; set; } // Mapped to INT
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Address { get; set; }
    public EnrollmentStatusEnum EnrollmentStatus { get; set; } = EnrollmentStatusEnum.Enrolled; // Mapped to INT
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    // ... navigation properties
}

public class StudentEnrollment
{
    [Key]
    public int EnrollmentId { get; set; }
    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }
    public int ClassId { get; set; }
    [ForeignKey("ClassId")]
    public virtual Class Class { get; set; }
    public int SectionId { get; set; }
    [ForeignKey("SectionId")]
    public virtual Section Section { get; set; }
    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }
    [StringLength(20)]
    public string? RollNumber { get; set; }
    [Column(TypeName = "date")]
    public DateTime EnrollmentDate { get; set; } = DateTime.UtcNow.Date;
    public bool IsActive { get; set; } = true;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}

public class Parent
{
    [Key]
    public int ParentId { get; set; }
    public int? UserId { get; set; }
    [ForeignKey("UserId")]
    public virtual User? User { get; set; }
    // ... other properties
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Address { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    // ... navigation properties
}

public class StudentParent // Junction
{
    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }
    public int ParentId { get; set; }
    [ForeignKey("ParentId")]
    public virtual Parent Parent { get; set; }
    public bool IsPrimaryContact { get; set; } = false;
}

public class StaffSalary
{
    [Key]
    public int SalaryId { get; set; }
    public int StaffId { get; set; }
    [ForeignKey("StaffId")]
    public virtual Staff Staff { get; set; }
    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }
    public int Month { get; set; }
    public int Year { get; set; }
    [Column(TypeName = "decimal(10, 2)")]
    public decimal BasicSalary { get; set; }
    [Column(TypeName = "decimal(10, 2)")]
    public decimal Allowances { get; set; }
    [Column(TypeName = "decimal(10, 2)")]
    public decimal Deductions { get; set; }
    [Column(TypeName = "decimal(10, 2)")]
    public decimal NetSalary { get; set; }
    [Column(TypeName = "date")]
    public DateTime? PaymentDate { get; set; }
    public SalaryPaymentStatusEnum PaymentStatus { get; set; } = SalaryPaymentStatusEnum.Pending; // Mapped to INT
    [Column(TypeName = "nvarchar(MAX)")]
    public string? TransactionDetails { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}

public class StaffPerformanceReview
{
    [Key]
    public int ReviewId { get; set; }
    public int StaffId { get; set; }
    [ForeignKey("StaffId")]
    [InverseProperty("PerformanceReviewsReceived")]
    public virtual Staff StaffMember { get; set; }
    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }
    [Column(TypeName = "date")]
    public DateTime ReviewDate { get; set; }
    public int ReviewerStaffId { get; set; }
    [ForeignKey("ReviewerStaffId")]
    [InverseProperty("PerformanceReviewsGiven")]
    public virtual Staff ReviewerStaff { get; set; }
    [Column(TypeName = "decimal(3, 1)")]
    public decimal? Rating { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Comments { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? GoalsForNextPeriod { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}

// --- Academic & Timetable Tables ---
public class Subject
{
    [Key]
    public int SubjectId { get; set; }
    [Required]
    [StringLength(100)]
    public string SubjectName { get; set; }
    [Required]
    [StringLength(20)]
    public string SubjectCode { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Description { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    // ... navigation properties
}

public class ClassSubject
{
    [Key]
    public int ClassSubjectId { get; set; }
    public int ClassId { get; set; }
    [ForeignKey("ClassId")]
    public virtual Class Class { get; set; }
    public int? SectionId { get; set; }
    [ForeignKey("SectionId")]
    public virtual Section? Section { get; set; }
    public int SubjectId { get; set; }
    [ForeignKey("SubjectId")]
    public virtual Subject Subject { get; set; }
    public int TeacherId { get; set; }
    [ForeignKey("TeacherId")]
    public virtual Staff Teacher { get; set; }
    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    // ... navigation properties
}

public class TimetableSlot
{
    [Key]
    public int SlotId { get; set; }
    [Required]
    public DayOfWeekEnum DayOfWeek { get; set; } // Mapped to INT
    [Required]
    [Column(TypeName = "time")]
    public TimeSpan StartTime { get; set; }
    [Required]
    [Column(TypeName = "time")]
    public TimeSpan EndTime { get; set; }
    [StringLength(50)]
    public string? SlotName { get; set; }
    public bool IsBreak { get; set; } = false;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    // ... navigation properties
}

public class TimetableEntry
{
    [Key]
    public int EntryId { get; set; }
    public int ClassSubjectId { get; set; }
    [ForeignKey("ClassSubjectId")]
    public virtual ClassSubject ClassSubject { get; set; }
    public int SlotId { get; set; }
    [ForeignKey("SlotId")]
    public virtual TimetableSlot Slot { get; set; }
    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }
    [StringLength(20)]
    public string? RoomNumber { get; set; }
    public int? SubstituteTeacherId { get; set; }
    [ForeignKey("SubstituteTeacherId")]
    public virtual Staff? SubstituteTeacher { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Notes { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    // ... navigation properties
}

public class StudentAttendance
{
    [Key]
    public int AttendanceId { get; set; }
    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }
    public int ClassId { get; set; } // Denormalized
    [ForeignKey("ClassId")]
    public virtual Class Class {get; set;}
    public int SectionId { get; set; } // Denormalized
    [ForeignKey("SectionId")]
    public virtual Section Section {get; set;}
    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear {get; set;}
    [Column(TypeName = "date")]
    public DateTime AttendanceDate { get; set; }
    public int? TimetableEntryId { get; set; }
    [ForeignKey("TimetableEntryId")]
    public virtual TimetableEntry? TimetableEntry { get; set; }
    [Required]
    public AttendanceStatusEnum Status { get; set; } // Mapped to INT
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Remarks { get; set; }
    public int RecordedByStaffId { get; set; }
    [ForeignKey("RecordedByStaffId")]
    public virtual Staff RecordedByStaff { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}

public class StaffAttendance
{
    [Key]
    public int StaffAttendanceId { get; set; }
    public int StaffId { get; set; }
    [ForeignKey("StaffId")]
    [InverseProperty("Attendances")]
    public virtual Staff StaffMember { get; set; }
    [Column(TypeName = "date")]
    public DateTime AttendanceDate { get; set; }
    [Required]
    public StaffAttendanceStatusEnum Status { get; set; } // Mapped to INT
    [Column(TypeName = "time")]
    public TimeSpan? CheckInTime { get; set; }
    [Column(TypeName = "time")]
    public TimeSpan? CheckOutTime { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Remarks { get; set; }
    public int RecordedByStaffId { get; set; }
    [ForeignKey("RecordedByStaffId")]
    [InverseProperty("RecordedStaffAttendances")]
    public virtual Staff RecordedByStaff { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}

// --- Examination & Academic Records Tables (Continue similarly) ---
public class ExamType
{
    [Key]
    public int ExamTypeId { get; set; }
    [Required]
    [StringLength(50)]
    public string TypeName { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<Exam> Exams { get; set; } = new List<Exam>();
}

public class Exam
{
    [Key]
    public int ExamId { get; set; }
    [Required]
    [StringLength(100)]
    public string ExamName { get; set; }
    public int ExamTypeId { get; set; }
    [ForeignKey("ExamTypeId")]
    public virtual ExamType ExamType { get; set; }
    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }
    [Column(TypeName = "date")]
    public DateTime StartDate { get; set; }
    [Column(TypeName = "date")]
    public DateTime EndDate { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<ExamSchedule> ExamSchedules { get; set; } = new List<ExamSchedule>();
}

public class ExamSchedule
{
    [Key]
    public int ExamScheduleId { get; set; }
    public int ExamId { get; set; }
    [ForeignKey("ExamId")]
    public virtual Exam Exam { get; set; }
    public int ClassId { get; set; }
    [ForeignKey("ClassId")]
    public virtual Class Class { get; set; }
    public int? SectionId { get; set; }
    [ForeignKey("SectionId")]
    public virtual Section? Section { get; set; }
    public int SubjectId { get; set; }
    [ForeignKey("SubjectId")]
    public virtual Subject Subject { get; set; }
    [Column(TypeName = "date")]
    public DateTime ExamDate { get; set; }
    [Column(TypeName = "time")]
    public TimeSpan StartTime { get; set; }
    [Column(TypeName = "time")]
    public TimeSpan EndTime { get; set; }
    [Column(TypeName = "decimal(5, 2)")]
    public decimal MaxMarks { get; set; }
    [Column(TypeName = "decimal(5, 2)")]
    public decimal PassingMarks { get; set; }
    [StringLength(20)]
    public string? RoomNumber { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<ExamResult> ExamResults { get; set; } = new List<ExamResult>();
}

public class ExamResult
{
    [Key]
    public int ResultId { get; set; }
    public int ExamScheduleId { get; set; }
    [ForeignKey("ExamScheduleId")]
    public virtual ExamSchedule ExamSchedule { get; set; }
    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }
    [Column(TypeName = "decimal(5, 2)")]
    public decimal MarksObtained { get; set; }
    [StringLength(10)]
    public string? Grade { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Remarks { get; set; }
    public bool IsAbsent { get; set; } = false;
    public int RecordedByStaffId { get; set; }
    [ForeignKey("RecordedByStaffId")]
    public virtual Staff RecordedByStaff { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}

public class Assignment
{
    [Key]
    public int AssignmentId { get; set; }
    public int ClassSubjectId { get; set; }
    [ForeignKey("ClassSubjectId")]
    public virtual ClassSubject ClassSubject { get; set; }
    [Required]
    [StringLength(255)]
    public string Title { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Description { get; set; }
    [Column(TypeName = "date")]
    public DateTime AssignedDate { get; set; }
    [Column(TypeName = "date")]
    public DateTime DueDate { get; set; }
    [Column(TypeName = "decimal(5, 2)")]
    public decimal? MaxMarks { get; set; }
    [StringLength(255)]
    public string? AttachmentURL { get; set; }
    public int TeacherId { get; set; }
    [ForeignKey("TeacherId")]
    public virtual Staff Teacher { get; set; }
    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<StudentAssignment> StudentAssignments { get; set; } = new List<StudentAssignment>();
}

public class StudentAssignment
{
    [Key]
    public int StudentAssignmentId { get; set; }
    public int AssignmentId { get; set; }
    [ForeignKey("AssignmentId")]
    public virtual Assignment Assignment { get; set; }
    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }
    public DateTime? SubmissionDate { get; set; } // DATETIME2 in SQL
    [StringLength(255)]
    public string? SubmittedFileURL { get; set; }
    [Column(TypeName = "decimal(5, 2)")]
    public decimal? MarksObtained { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Feedback { get; set; }
    public AssignmentStatusEnum Status { get; set; } = AssignmentStatusEnum.Pending; // Mapped to INT
    public int? GradedByStaffId { get; set; }
    [ForeignKey("GradedByStaffId")]
    public virtual Staff? GradedByStaff { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}

public class GradeScale
{
    [Key]
    public int GradeScaleId { get; set; }
    [Required]
    [StringLength(10)]
    public string GradeName { get; set; }
    [Column(TypeName = "decimal(5, 2)")]
    public decimal MinPercentage { get; set; }
    [Column(TypeName = "decimal(5, 2)")]
    public decimal MaxPercentage { get; set; }
    [StringLength(50)]
    public string? Description { get; set; }
    public int? AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear? AcademicYear { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}

public class ReportCard
{
    [Key]
    public int ReportCardId { get; set; }
    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }
    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }
    public int ClassId { get; set; }
    [ForeignKey("ClassId")]
    public virtual Class Class { get; set; }
    public int SectionId { get; set; }
    [ForeignKey("SectionId")]
    public virtual Section Section { get; set; }
    [Required]
    [StringLength(50)]
    public string TermName { get; set; }
    [Column(TypeName = "decimal(5, 2)")]
    public decimal? OverallPercentage { get; set; }
    [StringLength(10)]
    public string? OverallGrade { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? TeacherRemarks { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? PrincipalRemarks { get; set; }
    [Column(TypeName = "date")]
    public DateTime GeneratedDate { get; set; }
    [Column(TypeName = "date")]
    public DateTime? PublishedDate { get; set; }
    public ReportCardStatusEnum Status { get; set; } = ReportCardStatusEnum.Draft; // Mapped to INT
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}

// --- Fee Management Tables ---
public class FeeCategory
{
    [Key]
    public int FeeCategoryId { get; set; }
    [Required]
    [StringLength(100)]
    public string CategoryName { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Description { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<FeeStructure> FeeStructures { get; set; } = new List<FeeStructure>();
}

public class FeeStructure
{
    [Key]
    public int FeeStructureId { get; set; }
    public int FeeCategoryId { get; set; }
    [ForeignKey("FeeCategoryId")]
    public virtual FeeCategory FeeCategory { get; set; }
    public int? ClassId { get; set; }
    [ForeignKey("ClassId")]
    public virtual Class? Class { get; set; }
    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }
    [Column(TypeName = "decimal(10, 2)")]
    public decimal Amount { get; set; }
    [Required]
    public FeeFrequencyEnum Frequency { get; set; } // Mapped to INT
    [StringLength(50)]
    public string? DueDatePattern { get; set; }
    [Column(TypeName = "decimal(8, 2)")]
    public decimal LateFeePerDay { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Description { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<StudentFeeInstallment> StudentFeeInstallments { get; set; } = new List<StudentFeeInstallment>();
}

public class StudentFeeInstallment
{
    [Key]
    public int InstallmentId { get; set; }
    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }
    public int FeeStructureId { get; set; }
    [ForeignKey("FeeStructureId")]
    public virtual FeeStructure FeeStructure { get; set; }
    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }
    [Required]
    [StringLength(100)]
    public string InstallmentName { get; set; }
    [Column(TypeName = "decimal(10, 2)")]
    public decimal AmountDue { get; set; }
    [Column(TypeName = "date")]
    public DateTime DueDate { get; set; }
    [Column(TypeName = "decimal(10, 2)")]
    public decimal AmountPaid { get; set; }
    [Column(TypeName = "decimal(10, 2)")]
    public decimal WaiverAmount { get; set; }
    [Column(TypeName = "decimal(8, 2)")]
    public decimal LateFeeApplied { get; set; }

    [DatabaseGenerated(DatabaseGeneratedOption.Computed)] // For SQL computed column
    [Column(TypeName = "decimal(10, 2)")] // Ensure type matches computed column
    public decimal BalanceAmount { get; private set; } // Setter is private as DB computes it

    public FeeInstallmentStatusEnum Status { get; set; } = FeeInstallmentStatusEnum.Pending; // Mapped to INT
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<FeePayment> Payments { get; set; } = new List<FeePayment>();
}

public class FeePayment
{
    [Key]
    public int PaymentId { get; set; }
    public int InstallmentId { get; set; }
    [ForeignKey("InstallmentId")]
    public virtual StudentFeeInstallment Installment { get; set; }
    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }
    [Column(TypeName = "date")]
    public DateTime PaymentDate { get; set; }
    [Column(TypeName = "decimal(10, 2)")]
    public decimal AmountPaid { get; set; }
    [Required]
    public PaymentModeEnum PaymentMode { get; set; } // Mapped to INT
    [StringLength(100)]
    public string? TransactionID { get; set; }
    [Required]
    [StringLength(50)]
    public string ReceiptNumber { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Notes { get; set; }
    public int CollectedByStaffId { get; set; }
    [ForeignKey("CollectedByStaffId")]
    public virtual Staff CollectedByStaff { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}

// --- Library Tables ---
public class BookCategory
{
    [Key]
    public int BookCategoryId { get; set; }
    [Required]
    [StringLength(100)]
    public string CategoryName { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<LibraryBook> Books { get; set; } = new List<LibraryBook>();
}

public class LibraryBook
{
    [Key]
    public int BookId { get; set; }
    [Required]
    [StringLength(20)]
    public string ISBN { get; set; }
    [Required]
    [StringLength(255)]
    public string Title { get; set; }
    [Required]
    [StringLength(255)]
    public string Author { get; set; }
    [StringLength(100)]
    public string? Publisher { get; set; }
    public int? PublicationYear { get; set; }
    [StringLength(50)]
    public string? Edition { get; set; }
    public int BookCategoryId { get; set; }
    [ForeignKey("BookCategoryId")]
    public virtual BookCategory BookCategory { get; set; }
    public int TotalCopies { get; set; } = 1;
    public int AvailableCopies { get; set; } = 1; // Managed by app logic/triggers
    [StringLength(50)]
    public string? ShelfLocation { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<BookIssue> Issues { get; set; } = new List<BookIssue>();
}

public class BookIssue
{
    [Key]
    public int IssueId { get; set; }
    public int BookId { get; set; }
    [ForeignKey("BookId")]
    public virtual LibraryBook Book { get; set; }
    public int UserId { get; set; }
    [ForeignKey("UserId")]
    public virtual User User { get; set; }
    [Column(TypeName = "date")]
    public DateTime IssueDate { get; set; }
    [Column(TypeName = "date")]
    public DateTime DueDate { get; set; }
    [Column(TypeName = "date")]
    public DateTime? ReturnDate { get; set; }
    [Column(TypeName = "decimal(8, 2)")]
    public decimal FineAmount { get; set; }
    public FineStatusEnum FineStatus { get; set; } = FineStatusEnum.None; // Mapped to INT
    public int IssuedByStaffId { get; set; }
    [ForeignKey("IssuedByStaffId")]
    [InverseProperty("IssuedBooks")]
    public virtual Staff IssuedByStaff { get; set; }
    public int? ReceivedByStaffId { get; set; }
    [ForeignKey("ReceivedByStaffId")]
    [InverseProperty("ReceivedBooks")]
    public virtual Staff? ReceivedByStaff { get; set; }
    public BookIssueStatusEnum Status { get; set; } = BookIssueStatusEnum.Issued; // Mapped to INT
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}

// --- Transport Tables ---
public class TransportRoute
{
    [Key]
    public int RouteId { get; set; }
    [Required]
    [StringLength(100)]
    public string RouteName { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? RouteDescription { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<RouteStop> Stops { get; set; } = new List<RouteStop>();
    public virtual ICollection<VehicleRouteAssignment> VehicleAssignments { get; set; } = new List<VehicleRouteAssignment>();
}

public class RouteStop
{
    [Key]
    public int StopId { get; set; }
    public int RouteId { get; set; }
    [ForeignKey("RouteId")]
    public virtual TransportRoute Route { get; set; }
    [Required]
    [StringLength(100)]
    public string StopName { get; set; }
    [Column(TypeName = "decimal(10, 8)")]
    public decimal? Latitude { get; set; }
    [Column(TypeName = "decimal(11, 8)")]
    public decimal? Longitude { get; set; }
    [Column(TypeName = "time")]
    public TimeSpan? PickupTime { get; set; }
    [Column(TypeName = "time")]
    public TimeSpan? DropTime { get; set; }
    public int SequenceOrder { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    [InverseProperty("PickupStop")]
    public virtual ICollection<StudentTransportAllocation> PickupAllocations { get; set; } = new List<StudentTransportAllocation>();
    [InverseProperty("DropStop")]
    public virtual ICollection<StudentTransportAllocation> DropAllocations { get; set; } = new List<StudentTransportAllocation>();
}

public class Vehicle
{
    [Key]
    public int VehicleId { get; set; }
    [Required]
    [StringLength(20)]
    public string VehicleNumber { get; set; }
    [StringLength(50)]
    public string VehicleType { get; set; } = "Bus";
    public int Capacity { get; set; }
    public int? DriverStaffId { get; set; }
    [ForeignKey("DriverStaffId")]
    [InverseProperty("DrivenVehicles")]
    public virtual Staff? DriverStaff { get; set; }
    public int? AttendantStaffId { get; set; }
    [ForeignKey("AttendantStaffId")]
    [InverseProperty("AttendedVehicles")]
    public virtual Staff? AttendantStaff { get; set; }
    [StringLength(50)]
    public string? GPSDeviceID { get; set; }
    public VehicleStatusEnum Status { get; set; } = VehicleStatusEnum.Active; // Mapped to INT
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<VehicleRouteAssignment> RouteAssignments { get; set; } = new List<VehicleRouteAssignment>();
}

public class VehicleRouteAssignment
{
    [Key]
    public int AssignmentID { get; set; } // SQL used AssignmentID
    public int VehicleId { get; set; }
    [ForeignKey("VehicleId")]
    public virtual Vehicle Vehicle { get; set; }
    public int RouteId { get; set; }
    [ForeignKey("RouteId")]
    public virtual TransportRoute Route { get; set; }
    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }
    [Column(TypeName = "date")]
    public DateTime StartDate { get; set; }
    [Column(TypeName = "date")]
    public DateTime? EndDate { get; set; }
    public bool IsActive { get; set; } = true;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<StudentTransportAllocation> StudentAllocations { get; set; } = new List<StudentTransportAllocation>();
}

public class StudentTransportAllocation
{
    [Key]
    public int AllocationID { get; set; } // SQL used AllocationID
    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }
    public int VehicleRouteAssignmentID { get; set; }
    [ForeignKey("VehicleRouteAssignmentID")]
    public virtual VehicleRouteAssignment VehicleRouteAssignment { get; set; }
    public int PickupStopId { get; set; }
    [ForeignKey("PickupStopId")]
    public virtual RouteStop PickupStop { get; set; }
    public int DropStopId { get; set; }
    [ForeignKey("DropStopId")]
    public virtual RouteStop DropStop { get; set; }
    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }
    [Column(TypeName = "date")]
    public DateTime StartDate { get; set; }
    [Column(TypeName = "date")]
    public DateTime? EndDate { get; set; }
    public bool IsActive { get; set; } = true;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}

// --- Communication Tables ---
public class Announcement
{
    [Key]
    public int AnnouncementId { get; set; }
    [Required]
    [StringLength(255)]
    public string Title { get; set; }
    [Required]
    [Column(TypeName = "nvarchar(MAX)")]
    public string Content { get; set; }
    public DateTime PublishDate { get; set; } // DATETIME2 in SQL
    public DateTime? ExpiryDate { get; set; } // DATETIME2 in SQL
    public int PostedByUserId { get; set; }
    [ForeignKey("PostedByUserId")]
    public virtual User PostedByUser { get; set; }
    [StringLength(255)]
    public string? AttachmentURL { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<AnnouncementAudience> Audiences { get; set; } = new List<AnnouncementAudience>();
}

public class AnnouncementAudience // Junction
{
    // Composite Key to be defined in OnModelCreating (see DbContext example)
    // This entity structure might need refinement depending on how targeting works
    public int AnnouncementId { get; set; }
    [ForeignKey("AnnouncementId")]
    public virtual Announcement Announcement { get; set; }

    public int? RoleId { get; set; }
    [ForeignKey("RoleId")]
    public virtual Role? Role { get; set; }

    public int? ClassId { get; set; }
    [ForeignKey("ClassId")]
    public virtual Class? Class { get; set; }

    public int? SectionId { get; set; }
    [ForeignKey("SectionId")]
    public virtual Section? Section { get; set; }
}

public class Message
{
    [Key]
    public int MessageId { get; set; }
    public int SenderUserId { get; set; }
    [ForeignKey("SenderUserId")]
    [InverseProperty("SentMessages")]
    public virtual User SenderUser { get; set; }
    public int ReceiverUserId { get; set; }
    [ForeignKey("ReceiverUserId")]
    [InverseProperty("ReceivedMessages")]
    public virtual User ReceiverUser { get; set; }
    [StringLength(255)]
    public string? Subject { get; set; }
    [Required]
    [Column(TypeName = "nvarchar(MAX)")]
    public string Content { get; set; }
    public DateTime SentTimestamp { get; set; } = DateTime.UtcNow; // DATETIME2
    public DateTime? ReadTimestamp { get; set; } // DATETIME2
    public bool IsRead { get; set; } = false;
    public int? ParentMessageId { get; set; }
    [ForeignKey("ParentMessageId")]
    public virtual Message? ParentMessage { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<Message> Replies { get; set; } = new List<Message>();
}

// --- Inventory & Events Tables ---
public class InventoryCategory
{
    [Key]
    public int InventoryCategoryId { get; set; }
    [Required]
    [StringLength(100)]
    public string CategoryName { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Description { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<InventoryItem> Items { get; set; } = new List<InventoryItem>();
}

public class InventoryItem
{
    [Key]
    public int ItemId { get; set; }
    [Required]
    [StringLength(255)]
    public string ItemName { get; set; }
    public int InventoryCategoryId { get; set; }
    [ForeignKey("InventoryCategoryId")]
    public virtual InventoryCategory InventoryCategory { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Description { get; set; }
    public int Quantity { get; set; }
    [Column(TypeName = "decimal(10, 2)")]
    public decimal? UnitPrice { get; set; }
    [StringLength(100)]
    public string? Supplier { get; set; }
    [Column(TypeName = "date")]
    public DateTime? PurchaseDate { get; set; }
    [StringLength(100)]
    public string? Location { get; set; }
    [StringLength(100)]
    public string? SerialNumber { get; set; }
    public InventoryItemConditionEnum Condition { get; set; } = InventoryItemConditionEnum.Good; // Mapped to INT
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}

public class EventType
{
    [Key]
    public int EventTypeId { get; set; }
    [Required]
    [StringLength(50)]
    public string TypeName { get; set; }
    [StringLength(7)]
    public string? ColorCode { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<Event> Events { get; set; } = new List<Event>();
}

public class Event
{
    [Key]
    public int EventId { get; set; }
    [Required]
    [StringLength(255)]
    public string EventName { get; set; }
    public int EventTypeId { get; set; }
    [ForeignKey("EventTypeId")]
    public virtual EventType EventType { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Description { get; set; }
    public DateTime StartDate { get; set; } // DATETIME2
    public DateTime EndDate { get; set; }   // DATETIME2
    [StringLength(100)]
    public string? Location { get; set; }
    public bool IsHoliday { get; set; } = false;
    public int? OrganizerStaffId { get; set; }
    [ForeignKey("OrganizerStaffId")]
    public virtual Staff? OrganizerStaff { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Audience { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}

// --- Hostel (Optional) Tables ---
public class HostelBlock
{
    [Key]
    public int BlockId { get; set; }
    [Required]
    [StringLength(50)]
    public string BlockName { get; set; }
    public int? WardenStaffId { get; set; }
    [ForeignKey("WardenStaffId")]
    public virtual Staff? WardenStaff { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<HostelRoom> Rooms { get; set; } = new List<HostelRoom>();
}

public class HostelRoomType
{
    [Key]
    public int RoomTypeId { get; set; }
    [Required]
    [StringLength(50)]
    public string TypeName { get; set; }
    public int Capacity { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Description { get; set; }
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<HostelRoom> Rooms { get; set; } = new List<HostelRoom>();
}

public class HostelRoom
{
    [Key]
    public int RoomId { get; set; }
    public int BlockId { get; set; }
    [ForeignKey("BlockId")]
    public virtual HostelBlock Block { get; set; }
    public int RoomTypeId { get; set; }
    [ForeignKey("RoomTypeId")]
    public virtual HostelRoomType RoomType { get; set; }
    [Required]
    [StringLength(20)]
    public string RoomNumber { get; set; }
    [StringLength(10)]
    public string? Floor { get; set; }
    public HostelRoomStatusEnum Status { get; set; } = HostelRoomStatusEnum.Available; // Mapped to INT
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
    public virtual ICollection<HostelAllocation> Allocations { get; set; } = new List<HostelAllocation>();
}

public class HostelAllocation
{
    [Key]
    public int AllocationID { get; set; } // SQL used AllocationID
    public int StudentId { get; set; }
    [ForeignKey("StudentId")]
    public virtual Student Student { get; set; }
    public int RoomId { get; set; }
    [ForeignKey("RoomId")]
    public virtual HostelRoom Room { get; set; }
    public int AcademicYearId { get; set; }
    [ForeignKey("AcademicYearId")]
    public virtual AcademicYear AcademicYear { get; set; }
    [Column(TypeName = "date")]
    public DateTime AllocationDate { get; set; }
    [Column(TypeName = "date")]
    public DateTime? VacateDate { get; set; }
    [Column(TypeName = "nvarchar(MAX)")]
    public string? Notes { get; set; }
    public bool IsActive { get; set; } = true;
    public DateTime CreatedAt { get; set; } = DateTime.UtcNow;
    public DateTime UpdatedAt { get; set; } = DateTime.UtcNow;
}

// ------------ DbContext Example ------------
/*
public class SchoolDbContext : DbContext
{
    public SchoolDbContext(DbContextOptions<SchoolDbContext> options) : base(options) { }

    // Add DbSets for all entities here
    public DbSet<User> Users { get; set; }
    public DbSet<Role> Roles { get; set; }
    public DbSet<UserRole> UserRoles { get; set; }
    // ... and so on for every entity class

    protected override void OnModelCreating(ModelBuilder modelBuilder)
    {
        base.OnModelCreating(modelBuilder);

        // --- Configure Composite Primary Keys for Join Tables ---
        modelBuilder.Entity<UserRole>().HasKey(ur => new { ur.UserId, ur.RoleId });
        modelBuilder.Entity<RolePermission>().HasKey(rp => new { rp.RoleId, rp.PermissionId });
        modelBuilder.Entity<StudentParent>().HasKey(sp => new { sp.StudentId, sp.ParentId });
        // For AnnouncementAudiences, PK configuration depends on its exact structure.
        // If RoleId, ClassId, SectionId can be part of a composite key and not all null:
        // modelBuilder.Entity<AnnouncementAudience>()
        //    .HasKey(aa => new { aa.AnnouncementId, aa.RoleId, aa.ClassId, aa.SectionId });
        // This is complex if some parts of the key can be NULL.
        // A better approach for AnnouncementAudience might be a surrogate key AudienceId
        // or separate junction tables if targets are exclusive.
        // If using the provided flexible (but PK-problematic) AnnouncementAudience:
        // You might need to assign a surrogate PK or handle it differently.
        // For the example, if you want EF to manage it without a defined PK in the class (EF Core 5+ convention):
        // modelBuilder.Entity<AnnouncementAudience>()
        //    .HasNoKey(); // Or define a surrogate key in the class

        // --- Configure Unique Constraints (Indexes) via Fluent API ---
        modelBuilder.Entity<User>().HasIndex(u => u.Username).IsUnique();
        modelBuilder.Entity<User>().HasIndex(u => u.Email).IsUnique();
        modelBuilder.Entity<Role>().HasIndex(r => r.RoleName).IsUnique();
        modelBuilder.Entity<Permission>().HasIndex(p => p.PermissionName).IsUnique();
        modelBuilder.Entity<Staff>().HasIndex(s => s.EmployeeID).IsUnique();
        modelBuilder.Entity<Staff>().HasIndex(s => s.Email).IsUnique();
        modelBuilder.Entity<Student>().HasIndex(s => s.AdmissionNumber).IsUnique();
        modelBuilder.Entity<Student>().HasIndex(s => s.Email).IsUnique().HasFilter("[Email] IS NOT NULL"); // SQL Server specific filter for nullable unique
        modelBuilder.Entity<Parent>().HasIndex(p => p.Email).IsUnique();
        modelBuilder.Entity<Subject>().HasIndex(s => s.SubjectCode).IsUnique();
        // ... other unique constraints from SQL schema comments

        modelBuilder.Entity<StudentEnrollment>()
            .HasIndex(se => new { se.StudentId, se.AcademicYearId })
            .IsUnique();
        modelBuilder.Entity<ClassSubject>()
            .HasIndex(cs => new { cs.ClassId, cs.SectionId, cs.SubjectId, cs.AcademicYearId })
            .IsUnique()
            .HasFilter("[SectionId] IS NOT NULL"); // Example if SectionId is part of the unique key only when not null
        // Or handle nullable parts of unique keys carefully. Often, a unique index in SQL allows multiple NULLs.
        // ... and so on for other unique constraints.

        // --- Configure Relationships that might be ambiguous or need specific cascade delete behaviors ---
        modelBuilder.Entity<Message>()
            .HasMany(m => m.Replies)
            .WithOne(m => m.ParentMessage)
            .HasForeignKey(m => m.ParentMessageId)
            .OnDelete(DeleteBehavior.NoAction); // As per SQL schema

        modelBuilder.Entity<StaffPerformanceReview>()
            .HasOne(spr => spr.StaffMember)
            .WithMany(s => s.PerformanceReviewsReceived)
            .HasForeignKey(spr => spr.StaffId)
            .OnDelete(DeleteBehavior.Cascade); // As per SQL schema

        modelBuilder.Entity<StaffPerformanceReview>()
            .HasOne(spr => spr.ReviewerStaff)
            .WithMany(s => s.PerformanceReviewsGiven)
            .HasForeignKey(spr => spr.ReviewerStaffId)
            .OnDelete(DeleteBehavior.NoAction); // As per SQL schema

        modelBuilder.Entity<StudentTransportAllocation>()
            .HasOne(sta => sta.PickupStop)
            .WithMany(rs => rs.PickupAllocations)
            .HasForeignKey(sta => sta.PickupStopId)
            .OnDelete(DeleteBehavior.NoAction);

        modelBuilder.Entity<StudentTransportAllocation>()
            .HasOne(sta => sta.DropStop)
            .WithMany(rs => rs.DropAllocations)
            .HasForeignKey(sta => sta.DropStopId)
            .OnDelete(DeleteBehavior.NoAction);

        // Set default schema if not dbo
        // modelBuilder.HasDefaultSchema("YourSchema");

        // Enum to string conversion (if you preferred NVARCHAR in DB for enums)
        // modelBuilder.Entity<User>().Property(e => e.UserType).HasConversion<string>();

        // For computed column BalanceAmount in StudentFeeInstallment
        modelBuilder.Entity<StudentFeeInstallment>()
            .Property(p => p.BalanceAmount)
            .HasComputedColumnSql("([AmountDue] + [LateFeeApplied] - [AmountPaid] - [WaiverAmount])", stored: true);


        // Ensure NVARCHAR(MAX) is used where C# string has no StringLength and corresponds to TEXT in original model
        // EF Core maps string to NVARCHAR(MAX) by default if no length is specified.
        // Explicitly:
        // modelBuilder.Entity<Role>().Property(p => p.Description).HasColumnType("nvarchar(MAX)");
    }
}
*/
```

This provides the SQL DDL and the corresponding C# entity classes. Remember to adjust the `DbContext` `OnModelCreating` method to fully define all composite keys, unique indexes, and any specific relationship behaviors (like cascade deletes) that EF Core might not infer perfectly from conventions alone, especially for the more complex relationships and unique constraints involving nullable columns. The `[Column(TypeName = "nvarchar(MAX)")]` attribute can be added to string properties that correspond to `NVARCHAR(MAX)` in SQL if EF Core's default mapping isn't sufficient or for clarity. By default, `string` properties without a `[StringLength]` or `[MaxLength]` attribute are often mapped to `NVARCHAR(MAX)` by EF Core.